;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="3cab8645-a2ae-a4c8-3b8f-4b14e93bbd95")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,166926,e=>{"use strict";var t=e.i(478902),s=e.i(202584),n=e.i(215261),a=e.i(898452),i=e.i(389959),r=e.i(158639),l=e.i(356003),o=e.i(283342),d=e.i(774803),c=e.i(914417),u=e.i(355901);e.i(128328);var h=e.i(86086),m=e.i(947748),p=e.i(657588),x=e.i(601224),g=e.i(215618),f=e.i(915083),j=e.i(805303),b=e.i(300475),y=e.i(234745),S=e.i(915993),w=e.i(150671),N=e.i(617361),v=e.i(162082),C=e.i(552423),T=e.i(265735),E=e.i(635494),_=e.i(541561),L=e.i(10429),k=e.i(887093),R=e.i(48189),I=e.i(432478),q=e.i(908937),A=e.i(317040),M=e.i(189329),D=e.i(201461),P=e.i(441081),O=e.i(739409),z=e.i(63519),K=e.i(837710),Q=e.i(843778),F=e.i(874311),V=e.i(725805),B=e.i(613580),$=e.i(106796),G=e.i(479095),U=e.i(466472);let H=({visible:e,hasDestructiveOperations:s,hasUpdateWithoutWhere:n,onCancel:a,onConfirm:i})=>(0,t.jsxs)(U.default,{visible:e,size:"large",title:`Potential issue${s&&n?"s":""} detected with your query`,confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:s&&n?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:a,onConfirm:i,children:[(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[s&&(0,t.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,t.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),s&&n&&(0,t.jsx)(G.Separator,{}),n&&(0,t.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,t.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,t.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,t.jsx)("code",{className:"text-code-inline",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,t.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]});var W=e.i(260305),Y=e.i(210928),X=e.i(888738),Z=e.i(884892);function J(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function ee(e){return e!=e.toLowerCase()?`"${e}"`:e}var et=e.i(869922),es=e.i(242882),en=e.i(714403),ea=e.i(246230);async function ei({projectRef:e,connectionString:t},s){let{result:n}=await (0,en.executeSql)({projectRef:e,connectionString:t,sql:`
SELECT word FROM pg_get_keywords();
`.trim(),queryKey:["keywords"]},s);return n.map(e=>e.word.toLocaleLowerCase())}var er=e.i(801834),el=e.i(926077),eo=e.i(124416),ed=e.i(106579),ec=e.i(420985),eu=e.i(283606),eh=e.i(314805),em=e.i(408279),ep=e.i(500850),ex=e.i(55956),eg=e.i(388019);let ef=(0,eg.default)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var ej=e.i(975924),eb=e.i(215312),ey=e.i(886554),eS=e.i(414833),ew=e.i(587433),eN=e.i(34411),ev=e.i(9679),eC=e.i(451031),eT=e.i(57492),eE=e.i(831927),e_=e.i(156722),eL=e.i(449123),ek=e.i(710483);let eR=["number","string","date"],eI=({results:e={rows:[]},config:s,onConfigChange:a})=>{var l;let o,{ref:d}=(0,r.useParams)(),[c,u]=(0,eo.useLocalStorageQuery)(m.LOCAL_STORAGE_KEYS.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(d),!1),h=(0,i.useMemo)(()=>Object.keys(e.rows[0]||{}).filter(t=>{let s=typeof e.rows[0][t];return eR.includes(s)}),[e]),p=(0,i.useMemo)(()=>e.rows[0]?Object.keys(e.rows[0]).filter(t=>{let s=e.rows[0][t];return"number"==typeof s||!isNaN(Number(s))}):[],[e]),x=s.xKey&&s.yKey,g=(0,i.useMemo)(()=>{if(!x)return!1;let t=typeof e.rows[0]?.[s.xKey],n=typeof e.rows[0]?.[s.yKey];return"number"===t&&"number"===n},[x,e.rows,s.xKey,s.yKey]),f=(0,i.useMemo)(()=>e?.rows?.length?e.rows.reduce((e,t)=>{let n=e[e.length-1]||{};return[...e,{...t,[s.yKey]:(n[s.yKey]||0)+t[s.yKey]}]},[]):[],[e,s]),j=s.cumulative?f:e.rows,b=(l=s.xKey,"number"==typeof(o=j?.[0]?.[l]||"")?"number":(0,ex.default)(o).isValid()?"date":"string");return h.length?(0,t.jsxs)(V.ResizablePanelGroup,{direction:"horizontal",className:"flex-grow h-full",children:[(0,t.jsx)(V.ResizablePanel,{className:"p-4 h-full",defaultSize:75,children:x?"bar"===s.type?(0,t.jsx)(ey.default,{showLegend:!0,size:"normal",xAxisIsDate:"date"===b,data:j,xAxisKey:s.xKey,yAxisKey:s.yKey,showGrid:s.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!s.showLabels,tickFormatter:e=>{let t=j[+e][s.xKey];return"date"===b?(0,ex.default)(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!s.showLabels,domain:[0,"dataMax"]}}):null:(0,t.jsx)(V.ResizablePanel,{className:"p-4 h-full",defaultSize:75,children:(0,t.jsx)(eS.default,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,t.jsx)(V.ResizableHandle,{withHandle:!0}),(0,t.jsxs)(V.ResizablePanel,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,t.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),s.xKey&&s.yKey&&(0,t.jsx)(eb.ButtonTooltip,{type:"text",size:"tiny",onClick:()=>{let e=s.xKey,t=s.yKey;a({...s,xKey:t,yKey:e})},disabled:!g,icon:(0,t.jsx)(ef,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:g?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),!c&&(0,t.jsxs)(ek.Admonition,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{onClick:()=>u(!0),className:"absolute top-3 right-3 opacity-30 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(ej.X,{size:14,className:"text-foreground-light"})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"Dismiss"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(ew.Badge,{variant:"success",children:"New"}),(0,t.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,t.jsx)("p",{className:"text-xs text-foreground-light !mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,t.jsx)(K.Button,{asChild:!0,size:"tiny",type:"default",className:"mt-1",children:(0,t.jsx)(n.default,{href:`/project/${d}/reports`,children:"Head to Reports"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ev.Label_Shadcn_,{className:"text-xs text-foreground-light",children:"X Axis"}),(0,t.jsxs)(eL.Select_Shadcn_,{value:s.xKey,onValueChange:e=>{a({...s,xKey:e})},children:[(0,t.jsx)(e_.SelectTrigger_Shadcn_,{children:s.xKey||"Select X Axis"}),(0,t.jsx)(eC.SelectContent_Shadcn_,{children:(0,t.jsx)(eT.SelectGroup_Shadcn_,{children:h.map(e=>(0,t.jsx)(eE.SelectItem_Shadcn_,{value:e,children:e},e))})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ev.Label_Shadcn_,{className:"text-xs text-foreground-light",children:"Y Axis"}),(0,t.jsxs)(eL.Select_Shadcn_,{value:s.yKey,onValueChange:e=>{a({...s,yKey:e})},children:[(0,t.jsx)(e_.SelectTrigger_Shadcn_,{children:s.yKey||"Select Y Axis"}),(0,t.jsx)(eC.SelectContent_Shadcn_,{children:(0,t.jsx)(eT.SelectGroup_Shadcn_,{children:p.map(e=>(0,t.jsx)(eE.SelectItem_Shadcn_,{value:e,children:e},e))})})]})]}),(0,t.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,t.jsxs)(ev.Label_Shadcn_,{className:"",htmlFor:"cumulative",children:[(0,t.jsx)(eN.Checkbox_Shadcn_,{id:"cumulative",name:"cumulative",checked:s.cumulative,onClick:()=>a({...s,cumulative:!s.cumulative})}),"Cumulative"]}),(0,t.jsxs)(ev.Label_Shadcn_,{htmlFor:"showLabels",children:[(0,t.jsx)(eN.Checkbox_Shadcn_,{id:"showLabels",name:"showLabels",checked:s.showLabels,onClick:()=>a({...s,showLabels:!s.showLabels})}),"Show labels"]}),(0,t.jsxs)(ev.Label_Shadcn_,{htmlFor:"showGrid",children:[(0,t.jsx)(eN.Checkbox_Shadcn_,{id:"showGrid",name:"showGrid",checked:s.showGrid,onClick:()=>a({...s,showGrid:!s.showGrid})}),"Show grid"]})]})]})]}):(0,t.jsx)("div",{className:"p-2",children:(0,t.jsx)(eS.default,{size:"normal",description:"Execute a query and configure the chart options."})})};var eq=e.i(419524),eA=e.i(370410),eM=e.i(718726);let eD=(0,eg.default)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var eP=e.i(471998),eO=e.i(686415),ez=e.i(282492),eK=e.i(362988),eQ=e.i(867637),eF=e.i(740010);let eV=({id:e})=>{let{profile:s}=(0,I.useProfile)(),n=(0,O.useSqlEditorV2StateSnapshot)().snippets[e],a=s?.id===n?.snippet.owner_id;return(0,t.jsx)(t.Fragment,{children:a?null:(0,t.jsx)(ew.Badge,{children:"Read-only"})})},eB=({id:e})=>{let{profile:n}=(0,I.useProfile)(),a=(0,O.useSqlEditorV2StateSnapshot)(),r=a.savingStates[e],l=(0,s.usePrevious)(r),[o,c]=(0,i.useState)(!1),u=a.snippets[e],h=n?.id===u?.snippet.owner_id;return(0,i.useEffect)(()=>{let e=!1;return"UPDATING"===l&&"IDLE"===r&&(c(!0),setTimeout(()=>{e||c(!1)},5e3)),()=>{e=!0}},[r]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[h&&"UPDATING_FAILED"===r&&(0,t.jsx)(K.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(eF.RefreshCcw,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>a.addNeedsSaving(e),children:"Retry"}),o?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eA.Check,{className:"text-brand",size:14,strokeWidth:3})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===r?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(d.Loader2,{className:"animate-spin",size:14,strokeWidth:2})}),(0,t.jsx)(B.TooltipContent,{children:"Saving changes..."})]}):"UPDATING_FAILED"===r?h?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eQ.AlertCircle,{className:"text-red-900",size:14,strokeWidth:2})}),(0,t.jsx)(B.TooltipContent,{children:"Failed to save changes"})]}):(0,t.jsx)(eV,{id:e}):null]})})},e$=({id:e,isExecuting:s=!1,isDisabled:n=!1,hasSelection:a=!1,prettifyQuery:i,executeQuery:l})=>{let{ref:o}=(0,r.useParams)(),d=(0,O.useSqlEditorV2StateSnapshot)(),[c]=(0,eo.useLocalStorageQuery)(m.LOCAL_STORAGE_KEYS.SQL_EDITOR_AI_OPEN,!0),[h,p]=(0,eo.useLocalStorageQuery)(m.LOCAL_STORAGE_KEYS.SQL_EDITOR_INTELLISENSE,!0),[x,g]=(0,eo.useLocalStorageQuery)(m.LOCAL_STORAGE_KEYS.SQL_EDITOR_LAST_SELECTED_DB(o),""),f=d.snippets[e],j=void 0!==f&&f.snippet.favorite,b=()=>{p(!h),u.toast.success(`Successfully ${h?"disabled":"enabled"} intellisense. ${h?"Please refresh your browser for changes to take place.":""}`)},y=()=>d.addFavorite(e),S=()=>d.removeFavorite(e);return(0,t.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2",children:[L.IS_PLATFORM&&(0,t.jsx)(eB,{id:e}),(0,t.jsxs)(F.DropdownMenu,{children:[(0,t.jsx)(F.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(K.Button,{"data-testid":"sql-editor-utility-actions",type:"default",className:(0,Q.cn)("px-1",c?"block 2xl:hidden":"hidden"),icon:(0,t.jsx)(eP.MoreVertical,{className:"text-foreground-light"})})}),(0,t.jsxs)(F.DropdownMenuContent,{className:"w-48",children:[(0,t.jsxs)(F.DropdownMenuItem,{className:"justify-between",onClick:b,children:[(0,t.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(eD,{size:14,className:"text-foreground-light"}),"Intellisense enabled"]}),h&&(0,t.jsx)(eA.Check,{className:"text-brand",size:16})]}),L.IS_PLATFORM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F.DropdownMenuSeparator,{}),(0,t.jsxs)(F.DropdownMenuItem,{className:"gap-x-2",onClick:()=>{j?S():y()},children:[(0,t.jsx)(eM.Heart,{size:14,strokeWidth:2,className:j?"fill-brand stroke-none":"fill-none stroke-foreground-light"}),j?"Remove from":"Add to"," favorites"]})]}),(0,t.jsxs)(F.DropdownMenuItem,{className:"gap-x-2",onClick:i,children:[(0,t.jsx)(eq.AlignLeft,{size:14,strokeWidth:2,className:"text-foreground-light"}),"Prettify SQL"]})]})]}),(0,t.jsxs)("div",{className:(0,Q.cn)("items-center gap-x-2",c?"hidden 2xl:flex":"flex"),children:[(0,t.jsxs)(F.DropdownMenu,{children:[(0,t.jsx)(F.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(K.Button,{type:"text",className:"px-1",icon:(0,t.jsx)(eD,{className:"text-foreground-light"})})}),(0,t.jsx)(F.DropdownMenuContent,{className:"w-48",children:(0,t.jsxs)(F.DropdownMenuItem,{className:"justify-between",onClick:b,children:["Intellisense enabled",h&&(0,t.jsx)(eA.Check,{className:"text-brand",size:16})]})})]}),L.IS_PLATFORM&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:j?(0,t.jsx)(K.Button,{type:"text",size:"tiny",onClick:S,className:"px-1",icon:(0,t.jsx)(eM.Heart,{className:"fill-brand stroke-none"})}):(0,t.jsx)(K.Button,{type:"text",size:"tiny",onClick:y,className:"px-1",icon:(0,t.jsx)(eM.Heart,{className:"fill-none stroke-foreground-light"})})}),(0,t.jsxs)(B.TooltipContent,{side:"bottom",children:[j?"Remove from":"Add to"," favorites"]})]}),(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(K.Button,{type:"text",onClick:i,className:"px-1",icon:(0,t.jsx)(eq.AlignLeft,{strokeWidth:2,className:"text-foreground-light"})})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",children:"Prettify SQL"})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,t.jsxs)("div",{className:"flex items-center",children:[L.IS_PLATFORM&&(0,t.jsx)(ez.DatabaseSelector,{selectedDatabaseId:0===x.length?void 0:x,variant:"connected-on-right",onSelectId:t=>{d.resetResults(e),g(t)}}),(0,t.jsx)(eO.RoleImpersonationPopover,{serviceRoleLabel:"postgres",variant:L.IS_PLATFORM?"connected-on-both":"connected-on-right"}),(0,t.jsx)(eK.SqlRunButton,{hasSelection:a,isDisabled:n||s,isExecuting:s,className:"rounded-l-none min-w-[82px]",onClick:l})]})})]})};var eG=e.i(17203),eU=e.i(4196),eH=e.i(743371),eW=e.i(223600),eY=e.i(937942),eX=e.i(377451),eZ=e.i(540203),eJ=e.i(602089),e0=e.i(410339);let e1=(0,i.forwardRef)(({id:e,isExecuting:s,isDisabled:n,isDebugging:a,onDebug:i})=>{let{ref:l}=(0,r.useParams)(),o=(0,M.useDatabaseSelectorStateSnapshot)(),{data:c}=(0,T.useSelectedOrganizationQuery)(),u=(0,O.useSqlEditorV2StateSnapshot)(),[,h]=(0,eU.useQueryState)("showConnect",eU.parseAsBoolean.withDefault(!1)),m=u.results[e]?.[0],{data:p}=(0,eZ.useOrgSubscriptionQuery)({orgSlug:c?.slug}),{data:x}=(0,eX.useProjectSettingsV2Query)({projectRef:l}),g=(0,eH.subscriptionHasHipaaAddon)(p)&&x?.is_sensitive,f=m?.error?.message?.includes("canceling statement due to statement timeout")||m?.error?.message?.includes("upstream request timeout")||m?.error?.message?.includes("Query read timeout"),j=m?.error?.message?.includes("EHOSTUNREACH");if(s)return(0,t.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,t.jsx)(d.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(m?.error){let s=(m.error?.formattedError?.split("\n")??[]).filter(e=>e.length>0),r=o.selectedDatabaseId!==l&&m.error.message.includes("in a read-only transaction"),d=m.error.message.includes("Query is too large to be run via the SQL Editor");return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[f?(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("p",{className:"font-mono text-sm tracking-tight",children:"Error: SQL query ran into an upstream timeout"}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["You can either"," ",(0,t.jsx)(eY.InlineLink,{href:`${L.DOCS_URL}/guides/platform/performance#examining-query-performance`,children:"optimize your query"}),", or"," ",(0,t.jsx)(eY.InlineLink,{href:`${L.DOCS_URL}/guides/database/timeouts`,children:"increase the statement timeout"})," or ",(0,t.jsx)("span",{className:(0,Q.cn)(eY.InlineLinkClassName,"cursor-pointer"),onClick:()=>h(!0),children:"connect to your database directly"}),"."]})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[s.length>0?s.map((e,s)=>(0,t.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},`error-${s}`)):(0,t.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",m.error?.message]}),!f&&!j&&m.autoLimit&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",m.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),r&&(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),d&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,t.jsxs)("span",{onClick:()=>h(!0),className:(0,Q.cn)(eY.InlineLinkClassName,"flex items-center gap-x-1"),children:["connecting to your database directly",(0,t.jsx)(eG.ExternalLink,{size:12})]}),"."]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[r&&(0,t.jsx)(K.Button,{className:"py-2",type:"default",onClick:()=>{o.setSelectedDatabaseId(l),u.resetResults(e)},children:"Switch to primary database"}),s.length>0&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eW.default,{iconOnly:!0,type:"default",text:s.join("\n")})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",align:"center",children:(0,t.jsx)("span",{children:"Copy error"})})]}),!g&&(0,t.jsx)(K.Button,{icon:(0,t.jsx)(eJ.AiIconAnimation,{size:16,loading:a}),disabled:!!n||a,onClick:i,children:"Debug with Assistant"})]})]})})}return m?m.rows.length<=0?(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,t.jsx)(e0.default,{rows:m.rows}):(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,t.jsx)("code",{children:"Run"})," to execute your query."]})})});e1.displayName="UtilityTabResults";var e2=e.i(749844),e4=e.i(543851),e3=e.i(454370);function e8({mode:e,onToggleMode:s,summary:n,id:a,rows:i}){let r="visual"===e,l=(0,O.useSqlEditorV2StateSnapshot)(),{openSidebar:o}=(0,P.useSidebarManagerSnapshot)(),d=(0,A.useAiAssistantStateSnapshot)(),c=r&&n&&(n.totalTime>0||n.hasSeqScan&&!n.hasIndexScan);return(0,t.jsxs)("div",{className:"bg-surface-100 border-b px-4 py-3 flex flex-col gap-3 text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-medium text-foreground",children:"Query Execution Plan"}),c&&(0,t.jsx)("div",{className:"flex items-center gap-4 flex-wrap",children:n.totalTime>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-foreground-light",children:"/"}),(0,t.jsx)("span",{className:"text-foreground-light",children:"Total time"}),(0,t.jsxs)("span",{className:"font-mono font-medium text-foreground",children:[n.totalTime.toFixed(2),"ms"]})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[a&&i&&(0,t.jsx)(K.Button,{type:"default",size:"tiny",icon:(0,t.jsx)(eJ.AiIconAnimation,{size:14}),onClick:()=>{if(!a)return;let e=l.snippets[a]?.snippet;if(!e?.content?.sql)return;let{query:t,prompt:s}=function({sql:e,explainPlanRows:t}){let s=t.map(e=>e["QUERY PLAN"]).join("\n"),n=`Explain this PostgreSQL EXPLAIN ANALYZE output in simple terms:

\`\`\`sql
${e}
\`\`\`

\`\`\`
${s}
\`\`\`

Format your response with:

**What it does** - 1-2 sentences.

**How it runs** - Briefly explain the plan from bottom to top in plain English. Mention key operations (scans, joins, sorts) and why PostgreSQL chose them.

**Issues** - Identify bottlenecks: slowest steps, sequential scans on large tables, inefficient joins, missing indexes. Be specific with timings from the plan.

**Fixes** - 2-3 specific suggestions with CREATE INDEX statements if applicable.

Keep it concise. Focus on actionable insights.`;return{query:e,prompt:n}}({sql:e.content.sql,explainPlanRows:i??[]});o(g.SIDEBAR_KEYS.AI_ASSISTANT),d.newChat({sqlSnippets:[{label:"Query",content:t}],initialMessage:s})},children:"Explain with AI"}),(0,t.jsx)(K.Button,{type:"default",size:"tiny",icon:r?(0,t.jsx)(e3.Code,{size:14}):(0,t.jsx)(e4.Eye,{size:14}),onClick:s,children:r?"Raw":"Visual"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-foreground-lighter",children:[(0,t.jsx)(e2.ArrowUp,{size:12,className:"text-foreground-light"}),(0,t.jsx)("span",{className:"font-medium text-foreground-light",children:"How to read:"}),(0,t.jsx)("span",{children:"Start at the bottom where data is read from tables, then follow upward as each step processes the results."})]}),r&&(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap text-foreground-lighter",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-warning"}),(0,t.jsx)("span",{children:"Seq Scan (slow)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-brand"}),(0,t.jsx)("span",{children:"Index Scan (fast)"})]})]})]})}var e5=e.i(416050),e6=e.i(88816),e7=e.i(710377);function e9(e){return void 0===e?"-":e.toLocaleString()}function te({actualRows:e,estimatedRows:s,rowsRemovedByFilter:n}){let a=void 0!==e,i=void 0!==s,r=void 0!==n&&a,l=r?e+n:void 0;return r&&void 0!==l?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 cursor-help",children:[(0,t.jsx)("span",{className:"text-foreground-light",children:e9(l)}),(0,t.jsx)(e7.ArrowRight,{size:10,className:"text-foreground-muted"}),(0,t.jsxs)("span",{className:"text-destructive-600 font-medium",children:["-",e9(n)]}),(0,t.jsx)(e7.ArrowRight,{size:10,className:"text-foreground-muted"}),(0,t.jsxs)("span",{className:"text-brand font-medium",children:[e9(e)," ",1===e?"row":"rows"]})]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Filter applied"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:[e9(l)," rows were scanned,"," ",e9(n)," were filtered out, leaving"," ",e9(e)," rows. Consider adding an index to reduce rows scanned."]})]})]}):a?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("span",{className:"text-foreground-light cursor-help",children:[e9(e)," ",1===e?"row":"rows"]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Rows returned"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["This operation processed and returned ",e9(e)," rows."]})]})]}):i?(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)("span",{className:"text-foreground-muted cursor-help",children:["est. ",e9(s)," ",1===s?"row":"rows"]})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsx)("p",{className:"font-medium",children:"Estimated rows"}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["The planner estimates this operation will return ",e9(s)," rows. Run with EXPLAIN ANALYZE to see actual row counts."]})]})]}):(0,t.jsx)("span",{className:"text-foreground-muted",children:"-"})}function tt(e){let t=parseFloat(e);return Number.isFinite(t)?t:void 0}function ts(e){let t=parseInt(e,10);return Number.isNaN(t)?void 0:t}function tn(e){if(e.details){let t=e.details.match(/Rows Removed by Filter:\s*(\d+)/);t&&(e.rowsRemovedByFilter=ts(t[1]))}e.children.forEach(tn)}function ta({node:e,depth:s,maxDuration:n}){let[a,r]=(0,i.useState)(!1),l=e.children.length>0,o=!!e.details?.trim(),d=function(e){if(!e)return[];let t=e.split("\n").filter(Boolean),s=[];for(let e of t){let t=e.indexOf(":");t>0?s.push({label:e.substring(0,t+1),value:e.substring(t+1).trim()}):e.trim()&&s.push({label:"",value:e.trim()})}return s}(e.details),c=24*s,u=e.actualTime?e.actualTime.end-e.actualTime.start:0,h=e.actualTime&&u>0,m=n>0?u/n*100:0,p=(0,x.getScanBarColor)(e.operation),g=(0,x.getScanBorderColor)(e.operation);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"group",children:[(0,t.jsxs)("div",{className:(0,Q.cn)("flex items-stretch border-b-border-muted border-b border-l-4 transition-colors bg-studio group-hover:bg-surface-100/50",g),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 shrink-0 min-w-[400px]",style:{paddingLeft:`${16+c}px`},children:[(0,t.jsx)("button",{type:"button",onClick:()=>o&&r(!a),disabled:!o,className:(0,Q.cn)("flex items-center justify-center w-5 h-5 rounded border border-border-muted shrink-0",o?"hover:bg-surface-200 cursor-pointer":"opacity-30 cursor-default"),"aria-label":a?"Collapse details":"Expand details",children:a?(0,t.jsx)(e6.ChevronDown,{size:12,className:"text-foreground-light"}):(0,t.jsx)(e5.ChevronRight,{size:12,className:"text-foreground-light"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 font-mono text-xs min-w-0",children:[(0,t.jsx)("span",{className:"text-foreground uppercase font-medium whitespace-nowrap",children:e.operation}),(0,t.jsxs)("span",{className:"text-foreground-muted whitespace-nowrap",children:["(cost ",e.cost?.end?.toFixed(1)??"-",", estimated"," ",e.rows?.toLocaleString()??"?"," ",1===e.rows?"row":"rows",")"]})]})]}),(0,t.jsx)("div",{className:"flex-1 relative min-h-[43px] flex items-center",children:h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:(0,Q.cn)("absolute left-0 top-0 h-full",p),style:{width:`${m}%`}}),(0,t.jsxs)("div",{className:"relative flex items-center gap-2 font-mono text-xs whitespace-nowrap px-3",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"text-foreground-light cursor-help",children:(0,x.formatNodeDuration)(u)})}),(0,t.jsxs)(B.TooltipContent,{side:"top",className:"max-w-xs font-sans",children:[(0,t.jsxs)("p",{className:"font-medium",children:["Execution time: ",(0,x.formatNodeDuration)(u)]}),(0,t.jsxs)("p",{className:"text-foreground-lighter text-xs mt-1",children:["This is how long this operation took to execute. The bar width shows this as a percentage of the slowest operation (",Math.round(m),"%) â€” wider bars indicate where more time is spent."]})]})]}),(0,t.jsx)("span",{className:"text-foreground-muted",children:"/"}),(0,t.jsx)(te,{actualRows:e.actualRows,estimatedRows:e.rows,rowsRemovedByFilter:e.rowsRemovedByFilter})]})]})})]}),a&&d.length>0&&(0,t.jsx)("div",{className:(0,Q.cn)("border-b-border-muted border-b border-l-4 bg-studio group-hover:bg-surface-100/50",g),style:{paddingLeft:`${16+c+32}px`},children:(0,t.jsx)("div",{className:"px-4 py-3 space-y-2 font-mono text-xs",children:d.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-1",children:[e.label&&(0,t.jsx)("span",{className:"text-foreground-muted",children:e.label}),(0,t.jsx)("span",{className:"text-foreground-light break-all",children:e.value})]},s))})})]}),l&&e.children.map((e,a)=>(0,t.jsx)(ta,{node:e,depth:s+1,maxDuration:n},a))]})}function ti({rows:e,onShowRaw:s,id:n}){let a=(0,i.useMemo)(()=>{let t;return(t=function(e){let t=e.map(e=>e["QUERY PLAN"]||"").filter(Boolean),s=[],n=[],a=/^(Filter|Sort Key|Group Key|Hash Cond|Join Filter|Index Cond|Recheck Cond|Rows Removed by Filter|Rows Removed by Index Recheck|Output|Merge Cond|Sort Method|Worker \d+|Buffers|Planning Time|Execution Time|One-Time Filter|InitPlan|SubPlan):/;for(let e=0;e<t.length;e++){let i=t[e];if(!i.trim())continue;let r=i.match(/^(\s*)/),l=r?r[1].length:0,o=i.includes("->"),d=i,c=l;if(o){let e=i.indexOf("->");c=e,d=i.substring(e+2).trim()}else d=i.trim();if(d.startsWith("Planning Time:")||d.startsWith("Execution Time:")||d.startsWith("Planning:")||d.startsWith("Execution:"))continue;if(a.test(d)&&n.length>0){let e=n[n.length-1].node;e.details+=(e.details?"\n":"")+d;continue}if(!o&&n.length>0&&l>0){let e=n[n.length-1];if(l>e.indent&&!d.match(/^\w+.*\(cost=/)){e.node.details+=(e.node.details?"\n":"")+d;continue}}let u=d.match(/^(.+?)\s*(\([^)]*cost=[^)]+\)(?:\s*\([^)]+\))*)?\s*$/);if(!u)continue;let[,h,m]=u,p=m?m.replace(/^\(|\)$/g,"").replace(/\)\s*\(/g," "):void 0,x=h.trim(),g="",f=h.match(/^(.+?)\s+on\s+(.+)$/i),j=h.match(/^(.+?)\s+using\s+(.+)$/i);f?(x=f[1].trim(),g="on "+f[2].trim()):j&&(x=j[1].trim(),g="using "+j[2].trim()),function(e,t,s,n){for(;n.length>0&&n[n.length-1].indent>=t;)n.pop();0===n.length?s.push(e):n[n.length-1].node.children.push(e),n.push({node:e,indent:t})}(function(e,t,s,n,a){let i={operation:e.trim(),details:t?.trim()||"",level:n,children:[],raw:a};if(s){let e=s.match(/cost=([\d.]+)\.\.([\d.]+)/);if(e){let t=tt(e[1]),s=tt(e[2]);void 0!==t&&void 0!==s&&(i.cost={start:t,end:s})}let t=s.match(/rows=(\d+)/);t&&(i.rows=ts(t[1]));let n=s.match(/width=(\d+)/);n&&(i.width=ts(n[1]));let a=s.match(/actual time=([\d.]+)\.\.([\d.]+)/);if(a){let e=tt(a[1]),t=tt(a[2]);void 0!==e&&void 0!==t&&(i.actualTime={start:e,end:t});let n=s.substring(s.indexOf("actual time=")).match(/rows=(\d+)/);n&&(i.actualRows=ts(n[1]))}}return i}(x,g,p,o?Math.floor(c/6)+1:0,i),c,s,n)}return s}(e)).forEach(tn),t},[e]),r=(0,i.useMemo)(()=>a.reduce((e,t)=>Math.max(e,function e(t){return Math.max(t.actualTime?t.actualTime.end-t.actualTime.start:0,t.children.reduce((t,s)=>Math.max(t,e(s)),0))}(t)),0),[a]),l=(0,i.useMemo)(()=>{let e,t;return e={totalTime:0,totalCost:0,hasSeqScan:!1,seqScanTables:[],hasIndexScan:!1},t=s=>{s.actualTime&&(e.totalTime=Math.max(e.totalTime,s.actualTime.end)),s.cost&&(e.totalCost=Math.max(e.totalCost,s.cost.end));let n=s.operation.toLowerCase();if(n.includes("seq scan")){e.hasSeqScan=!0;let t=s.details.match(/on\s+((?:"[^"]+"|[\w]+)(?:\.(?:"[^"]+"|[\w]+))*)/);t&&e.seqScanTables.push(t[1])}n.includes("index")&&(e.hasIndexScan=!0),s.children.forEach(t)},a.forEach(t),e},[a]);return 0===a.length?(0,t.jsx)("div",{className:"bg-studio border-t",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-3 font-mono text-sm text-foreground-light",children:"No execution plan data available"})}):(0,t.jsxs)("div",{className:"bg-studio border-t h-full flex flex-col min-h-0",children:[s&&(0,t.jsx)(e8,{mode:"visual",onToggleMode:s,summary:l,id:n,rows:e}),(0,t.jsx)("div",{className:"flex-1 overflow-auto min-h-0",children:(0,t.jsx)("div",{className:"flex flex-col min-w-max pb-4",children:a.map((e,s)=>(0,t.jsx)(ta,{node:e,depth:0,maxDuration:r},s))})})]})}function tr({id:e,isExecuting:s}){let n=(0,O.useSqlEditorV2StateSnapshot)().explainResults[e],[a,r]=(0,i.useState)("visual");if(s)return(0,t.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,t.jsx)(d.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running EXPLAIN ANALYZE..."})]});if(n?.error){let e=(n.error?.formattedError?.split("\n")??[]).filter(e=>e.length>0);return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[(0,t.jsx)("div",{className:"flex flex-col gap-y-1",children:e.length>0?e.map((e,s)=>(0,t.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},`error-${s}`)):(0,t.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",n.error?.message]})}),(0,t.jsx)("div",{className:"flex items-center gap-x-2",children:e.length>0&&(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsx)(eW.default,{iconOnly:!0,type:"default",text:e.join("\n")})}),(0,t.jsx)(B.TooltipContent,{side:"bottom",align:"center",children:(0,t.jsx)("span",{children:"Copy error"})})]})})]})})}if(!n||0===n.rows.length)return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:"No execution plan available. The query will be analyzed when you switch to this tab."})});if(!(0,x.isExplainQuery)(n.rows))return(0,t.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,t.jsx)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:"Unable to parse explain results. Please try running the query again."})});let l=()=>r("visual"===a?"raw":"visual");return(0,t.jsx)("div",{className:"h-full flex flex-col",children:"visual"===a?(0,t.jsx)(ti,{rows:n.rows,onShowRaw:l,id:e}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e8,{mode:"raw",onToggleMode:l,id:e,rows:n.rows}),(0,t.jsx)(e0.default,{rows:n.rows})]})})}let tl={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1},to=({id:e,isExecuting:s,isExplainExecuting:n,isDebugging:a,isDisabled:i,hasSelection:l,prettifyQuery:o,executeQuery:d,executeExplainQuery:c,onDebug:h,activeTab:m="results",onActiveTabChange:x})=>{let{ref:g}=(0,r.useParams)(),{data:f}=(0,T.useSelectedOrganizationQuery)(),j=(0,O.useSqlEditorV2StateSnapshot)(),b=(0,p.useFlag)("ShowPrettyExplain"),y=j.snippets[e]?.snippet,S=j.results[e]?.[0],{mutate:w}=(0,v.useSendEventMutation)(),{mutate:N}=(0,ec.useContentUpsertMutation)({invalidateQueriesOnSuccess:!1,onMutate:async t=>{let{payload:s}=t;if("sql"!==s.type||!("chart"in s.content))return;let n={...y,content:{...y.content,chart:s.content.chart}};j.updateSnippet({id:e,snippet:n})},onError:async(e,t,s)=>{u.toast.error("Failed to update chart. Please try again.")}}),C=y&&"sql"===y.type&&y.content?.chart?y.content.chart:tl;return(0,t.jsxs)(ep.Tabs_Shadcn_,{value:m,onValueChange:e=>{"explain"===e&&c(),x?.(e)},className:"w-full h-full flex flex-col",children:[(0,t.jsxs)(eh.TabsList_Shadcn_,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(em.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"results",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),b&&(0,t.jsx)(em.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"explain",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Explain"})}),(0,t.jsx)(em.TabsTrigger_Shadcn_,{className:"py-3 text-xs",value:"chart",children:(0,t.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),S?.rows&&(0,t.jsx)(ed.DownloadResultsButton,{type:"text",results:S.rows,fileName:`Supabase Snippet ${y.name}`,onDownloadAsCSV:()=>w({action:"sql_editor_result_download_csv_clicked",groups:{project:g??"",organization:f?.slug??""}}),onCopyAsMarkdown:()=>{w({action:"sql_editor_result_copy_markdown_clicked",groups:{project:g??"",organization:f?.slug??""}})},onCopyAsJSON:()=>{w({action:"sql_editor_result_copy_json_clicked",groups:{project:g??"",organization:f?.slug??""}})}})]}),(0,t.jsx)(e$,{id:e,isExecuting:s,isDisabled:i,hasSelection:l,prettifyQuery:o,executeQuery:d})]}),(0,t.jsx)(eu.TabsContent_Shadcn_,{asChild:!0,value:"results",className:"mt-0 flex-grow",children:(0,t.jsx)(e1,{id:e,isExecuting:s,isDisabled:i,onDebug:h,isDebugging:a})}),b&&(0,t.jsx)(eu.TabsContent_Shadcn_,{asChild:!0,value:"explain",className:"mt-0 flex-grow",children:(0,t.jsx)(tr,{id:e,isExecuting:n})}),(0,t.jsx)(eu.TabsContent_Shadcn_,{asChild:!0,value:"chart",className:"mt-0 flex-grow",children:(0,t.jsx)(eI,{results:S,config:C,onConfigChange:function(t){g&&y?.id&&N({projectRef:g,payload:{...y,id:y.id,description:y.description||"",project_id:y.project_id||0,content:{...y.content,content_id:e,chart:t}}})}})})]})},td=(0,c.default)(()=>e.A(281524),{loadableGenerated:{modules:[496981]},ssr:!1}),tc=(0,c.default)(()=>e.A(803957).then(({DiffEditor:e})=>e),{loadableGenerated:{modules:[409735]},ssr:!1}),tu=()=>{let e=(0,R.detectOS)(),s=(0,a.useRouter)(),{ref:n,id:c}=(0,r.useParams)(),{profile:G}=(0,I.useProfile)(),{data:U}=(0,E.useSelectedProjectQuery)(),{data:en}=(0,T.useSelectedOrganizationQuery)(),ed=(0,l.useQueryClient)(),ec=(0,z.useTabsStateSnapshot)(),eu=(0,A.useAiAssistantStateSnapshot)(),{openSidebar:eh}=(0,P.useSidebarManagerSnapshot)(),em=(0,O.useSqlEditorV2StateSnapshot)(),ep=(0,D.useGetImpersonatedRoleState)(),ex=(0,M.useDatabaseSelectorStateSnapshot)(),{isHipaaProjectDisallowed:eg}=(0,C.useOrgAiOptInLevel)(),ef=(0,p.useFlag)("ShowPrettyExplain"),{sourceSqlDiff:ej,setSourceSqlDiff:eb,selectedDiffType:ey,setSelectedDiffType:eS,setIsAcceptDiffLoading:ew,isDiffOpen:eN,defaultSqlDiff:ev,closeDiff:eC}=(0,$.useSqlEditorDiff)(),{promptState:eT,setPromptState:eE,promptInput:e_,setPromptInput:eL,resetPrompt:ek}=(0,$.useSqlEditorPrompt)(),eR=(0,i.useRef)(null),eI=(0,i.useRef)(null),eq=(0,i.useRef)(null),eA=(0,i.useRef)(0),[eM,eD]=(0,i.useState)(!1),[eP,eO]=(0,i.useState)([]),[ez,eK]=(0,i.useState)(!1),[eQ,eF]=(0,i.useState)(!1),[eV,eB]=(0,i.useState)(!1),[e$,eG]=(0,i.useState)(!1),[eU,eH]=(0,i.useState)(!1),[eW,eY]=(0,i.useState)("results"),[eX,eZ]=(0,i.useMemo)(()=>{let e=(0,W.generateSnippetTitle)();return[e,(0,_.generateUuid)([`${e}.sql`])]},[c]),eJ=c&&"new"!==c?c:eZ,e0=em.limit,e1=em.results[eJ]?.[0],e2=!(eJ in em.snippets&&void 0!==em.snippets[eJ].snippet.content),e4="new"!==c&&e2;((e,t)=>{let{data:s}=(0,E.useSelectedProjectQuery)(),n=(0,O.useSqlEditorV2StateSnapshot)(),[a]=(0,eo.useLocalStorageQuery)(m.LOCAL_STORAGE_KEYS.SQL_EDITOR_INTELLISENSE,!0),{data:r,isSuccess:l}=(({projectRef:e,connectionString:t},{enabled:s=!0,...n}={})=>(0,es.useQuery)({queryKey:ea.databaseKeys.keywords(e),queryFn:({signal:s})=>ei({projectRef:e,connectionString:t},s),enabled:s&&void 0!==e,...n}))({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:a}),{data:o,isSuccess:d}=(0,et.useDatabaseFunctionsQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:a}),{data:c,isSuccess:u}=(0,er.useSchemasQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:a}),{data:h,isSuccess:p}=(0,el.useTableColumnsQuery)({projectRef:s?.ref,connectionString:s?.connectionString},{enabled:a}),x=(0,i.useRef)(null),g=a&&p&&u&&l&&d;g&&(null===x.current&&(x.current={}),x.current.tableColumns=h,x.current.schemas=c,x.current.keywords=r,x.current.functions=o),(0,i.useEffect)(()=>{if(t){let s=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(t){let s=t.getValue(),a=(0,k.formatSql)(s);return e&&n.setSql({id:e,sql:a}),[{range:t.getFullModelRange(),text:a}]}});return()=>s.dispose()}},[t]),(0,i.useEffect)(()=>{let e=null,s=null;g&&t&&g&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,s,n){try{let d=new Z.default(e,s.column-2,s.lineNumber-1);if('"'===n.triggerCharacter){var a,i,r=t,l=x,o=d;let e=[];if(!o.isFowardDQuote())return{suggestions:e};if(o.next(),o.isNextPeriod()){let t=o.readIdent(),s=!1;t.match(/^\".*?\"$/)&&(s=!0,t=J(t));let n=l.current.tableColumns.find(e=>s&&e.tablename===t||!s&&e.tablename.toLocaleLowerCase()==t.toLocaleLowerCase());if(!n)return{suggestions:e};n.columns.forEach(t=>{e.push({label:t.attname,kind:r.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else l.current.tableColumns.forEach(t=>{e.push({label:t.tablename,kind:r.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:e}}if("."===n.triggerCharacter)return function(e,t,s){var n,a;let i=[],r=(n=s,a=3,n.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=J(e)),{isQuoted:t,name:e}})),l=0,o=t.current.schemas.find(e=>{let t=r&&r.length>l?r[l]:{};return t.isQuoted&&e.name===t.name||!t.isQuoted&&e.name?.toLocaleLowerCase()==t.name?.toLocaleLowerCase()});if(o?l++:o=t.current.schemas.find(e=>"public"==e.name),r.length==l)return t.current.tableColumns.forEach(t=>{t.schemaname==o.name&&i.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:ee(t.tablename)})}),{suggestions:i};let d=t.current.tableColumns.find(e=>{let t=r&&r.length>l?r[l]:{};return e.schemaname==o.name&&t.isQuoted&&e.tablename===t.name||!t.isQuoted&&e.tablename?.toLocaleLowerCase()==t.name?.toLocaleLowerCase()});return d&&d.columns.forEach(t=>{i.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:ee(t.attname)})}),{suggestions:i}}(t,x,d);{let e;return a=t,i=x,e=[],i.current.keywords?.length>0&&i.current.keywords.forEach(t=>{e.push({label:t,kind:a.languages.CompletionItemKind.Keyword,insertText:t})}),i.current.schemas?.length>0&&i.current.schemas.forEach(t=>{e.push({label:t.name,kind:a.languages.CompletionItemKind.Keyword,insertText:t.name})}),i.current.tableColumns?.length>0&&i.current.tableColumns.forEach(t=>{let s="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;e.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?a.languages.CompletionItemKind.Class:a.languages.CompletionItemKind.Interface,insertText:ee(s)}),t.columns.forEach(s=>{if(!s)return;let n=e.find(e=>e.label===s?.attname&&e.kind===a.languages.CompletionItemKind.Field&&e.detail===s?.data_type);n?(n.tables.push(t.tablename),n.tables.sort(),n.documentation=n.tables.join(", ")):e.push({label:s.attname,kind:a.languages.CompletionItemKind.Field,detail:s.data_type,documentation:t.tablename,tables:[t.tablename],insertText:ee(s.attname)})})}),i.current.functions?.length>0&&i.current.functions.forEach(t=>{e.push({label:t.name,kind:a.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:e}}}catch(e){return{suggestions:[]}}}}),s=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let s=new Z.default(e,t.column-2,t.lineNumber-1),n=s.readArguments();if(n<0)return null;let a=s.readIdent();if(!a||a.match(/^\".*?\"$/))return null;let i=x.current.functions.find(e=>e.name.toLocaleLowerCase()===a.toLocaleLowerCase());if(!i||!i.args||i.args.length<n)return null;let r=Math.min(n,i.args.length-1),l=[];return l.push({label:`${i.name}(${i.argument_types})`,parameters:i.args.map(e=>({label:e.name}))}),{value:{signatures:l,activeSignature:0,activeParameter:r},dispose:()=>{}}}}));return()=>{e?.dispose(),s?.dispose()}},[g,t])})(eJ,eI.current);let{data:e3,isSuccess:e8}=(0,w.useReadReplicasQuery)({projectRef:n},{enabled:(0,y.isValidConnString)(U?.connectionString)}),{mutateAsync:e5}=(0,b.useSqlTitleGenerateMutation)(),{mutate:e6}=(0,v.useSendEventMutation)(),{mutate:e7,isPending:e9}=(0,N.useExecuteSqlMutation)({onSuccess(e,t){eJ&&(em.addResult(eJ,e.result,t.autoLimit),ef&&(0,x.isExplainQuery)(e.result)?(em.addExplainResult(eJ,e.result),eY("explain")):"explain"===eW&&eY("results")),ed.invalidateQueries({queryKey:S.lintKeys.lint(n)})},onError(e,t){if(eJ){if(e.position&&eI.current){let t=eR.current,s=eI.current,n=eM?t?.getSelection()?.startLineNumber??0:0,a=e.formattedError??"",i=a.slice(a.indexOf("LINE")),r=n+Number(i.slice(0,i.indexOf(":")).split(" ")[1]);if(!isNaN(r)){let e=t?.deltaDecorations([],[{range:new s.Range(r,1,r,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(t?.revealLineInCenter(r),eO(e))}}em.addResultError(eJ,e,t.autoLimit)}}}),{mutate:te,isPending:tt}=(0,N.useExecuteSqlMutation)({onSuccess(e){eJ&&(em.addExplainResult(eJ,e.result),eY("explain"))},onError(e){eJ&&(em.addExplainResultError(eJ,e),eY("explain"))}}),ts=(0,i.useCallback)(async(e,t)=>{try{let{title:s}=await e5({sql:t});em.renameSnippet({id:e,name:s});let n=(0,z.createTabId)("sql",{id:e});ec.updateTab(n,{label:s})}catch(e){}},[e5,em]),tn=(0,i.useCallback)(async()=>{if(eN)return;let e=(0,O.getSqlEditorV2StateSnapshot)().snippets[eJ];if(eR.current&&U){let t=eR.current,s=t.getSelection(),n=s?t.getModel()?.getValueInRange(s):void 0,a=e?(n||eR.current?.getValue())??e.snippet.content?.sql:n||eR.current?.getValue(),i=(0,k.formatSql)(a),r=eR?.current?.getModel();eR.current&&r&&(eR.current.executeEdits("apply-prettify-edit",[{text:i,range:r.getFullModelRange()}]),em.setSql({id:eJ,sql:i}))}},[eJ,eN,U,em]),ta=(0,i.useCallback)(async(e=!1)=>{if(eN)return;let t=(0,O.getSqlEditorV2StateSnapshot)().snippets[eJ];if(null!==eR.current&&!e9&&void 0!==U){let s=eR.current,a=s.getSelection(),i=a?s.getModel()?.getValueInRange(a):void 0,r=t?(i||eR.current?.getValue())??t.snippet.content?.sql:i||eR.current?.getValue(),l=!1,o=(0,X.checkDestructiveQuery)(r);!e&&o&&(eF(!0),eB(!0),l=!0);let d=(0,X.isUpdateWithoutWhere)(r);if(!e&&d&&(eF(!0),eG(!0),l=!0),l)return;!eg&&t?.snippet.name.startsWith(W.untitledSnippetTitle)&&h.IS_PLATFORM&&ts(eJ,r),eP.length>0&&(s?.deltaDecorations(eP,[]),eO([]));let c=ep(),m=e3?.find(e=>e.identifier===ex.selectedDatabaseId)?.connectionString;if(!(0,y.isValidConnString)(m))return u.toast.error("Unable to run query: Connection string is missing");let{appendAutoLimit:p}=(0,X.checkIfAppendLimitRequired)(r,e0),x=(0,X.suffixWithLimit)(r,e0);e7({projectRef:U.ref,connectionString:m,sql:(0,q.wrapWithRoleImpersonation)(x,c),autoLimit:p?e0:void 0,isRoleImpersonationEnabled:(0,D.isRoleImpersonationEnabled)(c.role),isStatementTimeoutDisabled:!0,contextualInvalidation:!0,handleError:e=>{throw e}}),e6({action:"sql_editor_query_run_button_clicked",groups:{project:n??"Unknown",organization:en?.slug??"Unknown"}})}},[eN,eJ,e9,U,eg,e7,ep,ts,ex.selectedDatabaseId,e3,e0]),ti=(0,i.useCallback)(async()=>{if(eN)return;let e=(0,O.getSqlEditorV2StateSnapshot)().snippets[eJ];if(null!==eR.current&&!tt&&void 0!==U){let t=eR.current,s=t.getSelection(),n=s?t.getModel()?.getValueInRange(s):void 0,a=e?(n||eR.current?.getValue())??e.snippet.content?.sql:n||eR.current?.getValue();if((0,x.splitSqlStatements)(a).length>1){em.addExplainResultError(eJ,{message:"EXPLAIN only works on a single SQL statement. Please select just one query to analyze."}),eY("explain");return}eP.length>0&&(t?.deltaDecorations(eP,[]),eO([]));let i=ep(),r=e3?.find(e=>e.identifier===ex.selectedDatabaseId)?.connectionString;if(!(0,y.isValidConnString)(r))return u.toast.error("Unable to run query: Connection string is missing");let l=(0,x.isExplainSql)(a)?a:`EXPLAIN ANALYZE ${a}`;te({projectRef:U.ref,connectionString:r,sql:(0,q.wrapWithRoleImpersonation)(l,i),isRoleImpersonationEnabled:(0,D.isRoleImpersonationEnabled)(i.role),handleError:e=>{throw e}})}},[eN,eJ,tt,U,te,ep,ex.selectedDatabaseId,e3,eP,em]),tr=(0,i.useCallback)(async(e,t)=>{if(!n)return console.error("Project ref is required");if(!G)return console.error("Profile is required");if(!U)return console.error("Project is required");try{let a=(0,X.createSqlSnippetSkeletonV2)({name:t,sql:e,owner_id:G.id,project_id:U.id});em.addSnippet({projectRef:n,snippet:a}),em.addNeedsSaving(a.id),s.push(`/project/${n}/sql/${a.id}`)}catch(e){u.toast.error(`Failed to create new query: ${e.message}`)}},[G?.id,U?.id,n,s,em]),tl=(0,i.useCallback)(async()=>{try{let e=em.snippets[eJ],t=em.results[eJ]?.[0];eh(g.SIDEBAR_KEYS.AI_ASSISTANT),eu.newChat({name:"Debug SQL snippet",sqlSnippets:[(e.snippet.content?.sql??"").replace(W.sqlAiDisclaimerComment,"").trim()],initialInput:`Help me to debug the attached sql snippet which gives the following error: 

${t.error.message}`})}catch(e){e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&u.toast.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[eJ,em.results,em.snippets]),tu=(0,i.useCallback)(async()=>{try{if(ew(!0),!ej||!eR.current||!eq.current)return;let e=eR.current.getModel(),t=eq.current.getModel();if(!e||!t)return;let s=t.modified.getValue();if(ey===Y.DiffType.NewSnippet){let{title:e}=await e5({sql:s});await tr(s,e)}else eR.current.executeEdits("apply-ai-edit",[{text:s,range:e.getFullModelRange()}]);e6({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:n??"Unknown",organization:en?.slug??"Unknown"}}),eS(Y.DiffType.Modification),ek(),eC()}finally{ew(!1)}},[ej,ey,tr,e5,s,eJ,em]),th=(0,i.useCallback)(()=>{e6({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:n??"Unknown",organization:en?.slug??"Unknown"}}),ek(),eC()},[eC,ek,e6]),[tm,tp]=(0,i.useState)(!1),tx=(0,i.useCallback)(async(e,t)=>{try{tp(!0);let e=await fetch(`${L.BASE_PATH}/api/ai/code/complete`,{method:"POST",headers:{"Content-Type":"application/json",...t?.headers??{}},body:JSON.stringify({projectRef:U?.ref,connectionString:U?.connectionString,language:"sql",orgSlug:en?.slug,...t?.body??{}})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to generate completion")}let s=await e.json(),n=t?.body?.completionMetadata??{},a=n.textBeforeCursor??"",i=n.textAfterCursor??"",r=n.selection??"",l=(0,k.formatSql)(a+s+i);eb({original:a+r+i,modified:l}),eS(Y.DiffType.Modification),eE(e=>({...e,isLoading:!1})),tp(!1)}catch(e){throw u.toast.error(`Failed to generate SQL: ${e?.message??"Unknown error"}`),tp(!1),e}},[en?.slug,U?.connectionString,U?.ref,eE,eS,eb]),tg=async(e,t)=>{try{eE(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let s=(await (0,y.constructHeaders)()).get("Authorization");await tx(e,{...s?{headers:{Authorization:s}}:void 0,body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eE(e=>({...e,isLoading:!1}))}};return(0,i.useEffect)(()=>(eJ&&(eC(),eE(e=>({...e,isOpen:!1}))),()=>{if(n){let e=(0,z.createTabId)("sql",{id:eJ});ec.updateTab(e,{scrollTop:eA.current})}}),[eC,eJ]),(0,i.useEffect)(()=>{let t=t=>{if(eN||eT.isOpen)switch(t.key){case"Enter":("macos"===e?t.metaKey:t.ctrlKey)&&eN&&(tu(),ek());return;case"Escape":eN&&th(),ek(),eR.current?.focus();return}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,eN,eT.isOpen,tu,th,ek]),(0,i.useEffect)(()=>{if(eN){let e=eq.current,t=e?.getModel();if(t&&t.original&&t.modified){t.original.setValue(ev.original),t.modified.setValue(ev.modified);let s=e.getModifiedEditor(),n=eT.startLineNumber;s.revealLineInCenter(n)}}},[ey,ej]),(0,i.useEffect)(()=>{if(e8){let e=e3.find(e=>e.identifier===n);ex.setSelectedDatabaseId(e?.identifier)}},[e8,e3,n]),(0,i.useEffect)(()=>{if(void 0!==em.diffContent){let{diffType:e,sql:t}=em.diffContent,s=eR.current?.getModel();s&&(0===(eR.current?.getValue()??"").length?eR.current?.executeEdits("apply-ai-message",[{text:`${t}`,range:s.getFullModelRange()}]):(eb({original:eR.current?.getValue()||"",modified:t}),eS(e)))}},[em.diffContent]),(0,i.useEffect)(()=>{if(eN){if(eq.current&&ez)return eH(!0),()=>eH(!1)}else eK(!1),eH(!1)},[eN,ez]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H,{visible:eQ,hasDestructiveOperations:eV,hasUpdateWithoutWhere:e$,onCancel:()=>{eF(!1),eB(!1),eG(!1),setTimeout(()=>eR.current?.focus(),100)},onConfirm:()=>{eF(!1),ta(!0)}}),(0,t.jsx)("div",{className:"flex h-full",children:(0,t.jsxs)(V.ResizablePanelGroup,{className:"relative",direction:"vertical",autoSaveId:m.LOCAL_STORAGE_KEYS.SQL_EDITOR_SPLIT_SIZE,children:[(0,t.jsx)(V.ResizablePanel,{defaultSize:50,maxSize:70,children:(0,t.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:e4?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)(d.Loader2,{className:"animate-spin text-brand"})}):(0,t.jsxs)(t.Fragment,{children:[eN&&(0,t.jsxs)("div",{className:"w-full h-full",children:[(0,t.jsx)(tc,{theme:"supabase",language:"pgsql",original:ev.original,modified:ev.modified,onMount:e=>{eq.current=e,eK(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3},keepCurrentModifiedModel:!0,keepCurrentOriginalModel:!0}),eU&&(0,t.jsx)(f.default,{editor:eq.current,id:"ask-ai-diff",value:e_,onChange:eL,onSubmit:e=>{tg(e,{beforeSelection:eT.beforeSelection,selection:eT.selection||ev.modified,afterSelection:eT.afterSelection})},onAccept:tu,onReject:th,onCancel:ek,isDiffVisible:!0,isLoading:tm,startLineNumber:Math.max(0,eT.startLineNumber),endLineNumber:eT.endLineNumber})]}),(0,t.jsxs)("div",{className:"w-full h-full relative",children:[(0,t.jsx)(td,{autoFocus:!0,placeholder:eT.isOpen||eR.current?.getValue()?"":"Hit "+("macos"===e?"CMD+K":"CTRL+K")+" to generate query or just start typing",id:eJ,snippetName:"new"===c?eX:em.snippets[eJ]?.snippet.name??eX,className:(0,Q.cn)(eN&&"hidden"),editorRef:eR,monacoRef:eI,executeQuery:ta,onHasSelection:eD,onMount:e=>{let t=(0,z.createTabId)("sql",{id:eJ}),s=ec.tabsMap[t];setTimeout(()=>{s?.metadata?.scrollTop&&e.setScrollTop(s.metadata.scrollTop)},20),e.onDidScrollChange(e=>eA.current=e.scrollTop)},onPrompt:({selection:e,beforeSelection:t,afterSelection:s,startLineNumber:n,endLineNumber:a})=>{eE(i=>({...i,isOpen:!0,selection:e,beforeSelection:t,afterSelection:s,startLineNumber:n,endLineNumber:a}))}}),eR.current&&eT.isOpen&&!eN&&(0,t.jsx)(f.default,{editor:eR.current,id:"ask-ai",value:e_,onChange:eL,onSubmit:e=>{tg(e,{beforeSelection:eT.beforeSelection,selection:eT.selection,afterSelection:eT.afterSelection})},onCancel:ek,isDiffVisible:!1,isLoading:tm,startLineNumber:Math.max(0,eT.startLineNumber),endLineNumber:eT.endLineNumber})]},eJ)]})})}),(0,t.jsx)(V.ResizableHandle,{withHandle:!0}),(0,t.jsx)(V.ResizablePanel,{defaultSize:50,maxSize:70,children:e4?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)(d.Loader2,{className:"animate-spin text-brand"})}):(0,t.jsx)(to,{id:eJ,isExecuting:e9,isExplainExecuting:tt,isDisabled:eN,hasSelection:eM,prettifyQuery:tn,executeQuery:ta,executeExplainQuery:ti,onDebug:tl,activeTab:eW,onActiveTabChange:eY})}),(0,t.jsx)("div",{className:"h-9",children:e1?.rows!==void 0&&!e9&&(0,t.jsxs)(j.GridFooter,{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)(B.Tooltip,{children:[(0,t.jsx)(B.TooltipTrigger,{children:(0,t.jsxs)("p",{className:"text-xs",children:[(0,t.jsxs)("span",{className:"text-foreground",children:[e1.rows.length," row",e1.rows.length>1?"s":""]}),(0,t.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==e1.autoLimit&&` (Limited to only ${e1.autoLimit} rows)`})]})}),(0,t.jsx)(B.TooltipContent,{className:"max-w-xs",children:(0,t.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,t.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==e1.autoLimit&&(0,t.jsxs)(F.DropdownMenu,{children:[(0,t.jsx)(F.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(K.Button,{type:"default",iconRight:(0,t.jsx)(o.ChevronUp,{size:14}),children:["Limit results to:"," ",W.ROWS_PER_PAGE_OPTIONS.find(e=>e.value===em.limit)?.label]})}),(0,t.jsx)(F.DropdownMenuContent,{className:"w-40",align:"end",children:(0,t.jsx)(F.DropdownMenuRadioGroup,{value:em.limit.toString(),onValueChange:e=>em.setLimit(Number(e)),children:W.ROWS_PER_PAGE_OPTIONS.map(e=>(0,t.jsx)(F.DropdownMenuRadioItem,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})]})};var th=e.i(448710),tm=e.i(569715),tp=e.i(795826),tx=e.i(79221),tg=e.i(326204),tf=e.i(853322),tj=e.i(990510);let tb=()=>{let e=(0,a.useRouter)(),{id:l,ref:o,content:d,skip:c}=(0,r.useParams)(),u=(0,s.usePrevious)(l),{data:h}=(0,E.useSelectedProjectQuery)(),m=(0,tp.useEditorType)(),p=(0,z.useTabsStateSnapshot)(),x=(0,O.useSqlEditorV2StateSnapshot)(),{history:g,setLastVisitedSnippet:f}=(0,tj.useDashboardHistory)(),j=(0,O.useSnippets)(o),b=j.find(e=>e.id===l),y=l?p.openTabs.find(e=>e.endsWith(l)):void 0,S=!!("new"!==l&&"function"==typeof x.addSnippet&&!b?.isNotSavedInDatabaseYet),{data:w,error:N,isError:v}=(0,tf.useContentIdQuery)({projectRef:o,id:l},{retry:!1,enabled:S}),C=v&&404===N.code&&N.message.includes("Content not found"),T=v&&400===N.code&&N.message.includes("Invalid uuid"),_=!!b&&C&&"new"===u&&"isNotSavedInDatabaseYet"in b;return((0,i.useEffect)(()=>{o&&w&&h&&(L.IS_PLATFORM&&w.project_id!==h.id?(f(void 0),e.push(`/project/${o}/sql/new`)):x.setSnippet(o,w))},[o,w,h]),(0,i.useEffect)(()=>{"new"===l&&"true"!==c&&void 0!==g.sql&&void 0===d&&void 0!==j.find(e=>e.id===g.sql)&&e.push(`/project/${o}/sql/${g.sql}`)},[l,j,d]),(0,i.useEffect)(()=>{if(!e.isReady||!l||"new"===l)return;let t=(0,z.createTabId)("sql",{id:l}),s=j.find(e=>e.id===l);p.addTab({id:t,type:"sql",label:s?.name||(0,W.generateSnippetTitle)(),metadata:{sqlId:l,name:s?.name}})},[e.isReady,l]),(C||T)&&!_)?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-[400px]",children:(0,t.jsx)(ek.Admonition,{type:"default",title:`Unable to find snippet with ID ${l}`,description:"This snippet doesn't exist in your project",children:y?(0,t.jsx)(K.Button,{type:"default",className:"mt-2",onClick:()=>{p.handleTabClose({id:y,router:e,editor:m,onClearDashboardHistory:()=>f(void 0)})},children:"Close tab"}):(0,t.jsx)(K.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>f(void 0),children:(0,t.jsx)(n.default,{href:`/project/${o}/sql`,children:"Head back"})})})})}):(0,t.jsx)(tu,{})};tb.getLayout=e=>(0,t.jsx)(th.default,{children:(0,t.jsx)(tm.EditorBaseLayout,{productMenu:(0,t.jsx)(tg.SQLEditorMenu,{}),product:"SQL Editor",children:(0,t.jsx)(tx.default,{children:e})})}),e.s(["default",0,tb],166926)},453513,(e,t,s)=>{let n="/project/[ref]/sql/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([n,()=>e.r(166926)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([n])})}]);

//# debugId=3cab8645-a2ae-a4c8-3b8f-4b14e93bbd95
//# sourceMappingURL=de5e0c85b993e24d.js.map