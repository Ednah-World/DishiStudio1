;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="860f1a41-69ab-5f29-4cce-8e5b85970190")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,561912,e=>{"use strict";var t=e.i(478902),s=e.i(389959);e.i(128328);var i=e.i(158639),n=e.i(902858),a=e.i(215261),r=e.i(898452),o=e.i(595519),l=e.i(276423),d=e.i(971131),c=e.i(962217),u=e.i(70756),m=e.i(681328),h=e.i(201461),p=e.i(636047),x=e.i(70255);function g(e,t){return e.indexOf(t)>=0}function f({gridRef:e,rows:t}){let i=(0,x.useTableEditorTableStateSnapshot)(),n=(0,s.useMemo)(()=>"windows"==(navigator?.appVersion.indexOf("Win")!==-1?"windows":navigator?.appVersion.indexOf("Mac")!==-1?"macos":"unknown")?"Control":"Command",[]);return!function(e,t=[],i=[]){let[n,a]=s.useState(),r=s=>{var n;if(!e||g(t,s.target.nodeName)||g(i,s.target.className))return;let r=(n=s).metaKey&&n.shiftKey?`Command+Shift+${n.key}`:n.metaKey?`Command+${n.key}`:n.shiftKey&&"Enter"===n.key?`Shift+${n.key}`:n.ctrlKey&&n.key?`Control+${n.key}`:n.key;e[r]&&(r.includes("+")?(s.preventDefault(),e[r](s),a(null)):(a(s.key),s.preventDefault()))},o=t=>{e&&e[t.key]&&n===t.key&&(t.preventDefault(),e[t.key](t),a(null))};s.useEffect(()=>(window.addEventListener("keydown",r),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",o)}))}({[`${n}+ArrowUp`]:t=>{if(t.stopPropagation(),i.selectedCellPosition){let t={idx:i.selectedCellPosition?.idx??0,rowIdx:0};e.current.selectCell(t)}else e.current.scrollToCell({rowIdx:Number(0)})},[`${n}+ArrowDown`]:s=>{if(s.stopPropagation(),i.selectedCellPosition){let s={idx:i.selectedCellPosition?.idx??0,rowIdx:t.length>1?t.length-1:0};e.current.selectCell(s)}else e.current.scrollToCell({rowIdx:Number(t.length)})},[`${n}+ArrowLeft`]:t=>{t.stopPropagation();let s={idx:i.gridColumns.filter(e=>e.frozen).length,rowIdx:i.selectedCellPosition?.rowIdx??0};e.current.selectCell(s)},[`${n}+ArrowRight`]:t=>{t.stopPropagation(),e.current?.selectCell({idx:i.gridColumns.length-2,rowIdx:i.selectedCellPosition?.rowIdx??0})}},["INPUT","TEXTAREA","SELECT"]),null}var b=e.i(4196),j=e.i(805303),y=e.i(425861),w=e.i(415190),v=e.i(635494),S=e.i(899850),N=e.i(3036),C=e.i(710377),T=e.i(382490),R=e.i(774803),E=e.i(201844),k=e.i(632459),_=e.i(821276),P=e.i(437893),L=e.i(837710),I=e.i(613580),D=e.i(746301),A=e.i(466472),$=e.i(205311),M=e.i(526925);let Q=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}],O=({onRowsPerPageChange:e})=>{let s=(0,p.useTableEditorStateSnapshot)();return(0,t.jsx)($.DropdownControl,{options:Q,onSelect:e,side:"top",align:"start",children:(0,t.jsx)(L.Button,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,t.jsx)("span",{children:`${s.rowsPerPage} rows`})})})},B=({enableForeignRowsQuery:e=!0})=>{let{id:n}=(0,i.useParams)(),a=n?Number(n):void 0,{sorts:r}=(0,_.useTableSort)(),{filters:o}=(0,k.useTableFilter)(),{data:l}=(0,v.useSelectedProjectQuery)(),d=(0,p.useTableEditorStateSnapshot)(),m=(0,x.useTableEditorTableStateSnapshot)(),g=(0,h.useRoleImpersonationStateSnapshot)(),{data:f}=(0,w.useTableEditorQuery)({projectRef:l?.ref,connectionString:l?.connectionString,id:a}),b=(0,c.isForeignTable)(f),j=m.page,y=(0,c.isTable)(f)?f.live_rows_estimate:null,[$,Q]=(0,s.useState)(j.toString()),[B,z]=(0,s.useState)(!1),[F,V]=(0,s.useState)(!1),[U,q]=(0,s.useState)(!1),{data:W,isPending:H,isSuccess:K,isError:G,isFetching:Y,error:J}=(0,P.useTableRowsCountQuery)({projectRef:l?.ref,connectionString:l?.connectionString,tableId:m.table.id,filters:o,enforceExactCount:m.enforceExactCount,roleImpersonationState:g},{placeholderData:E.keepPreviousData,enabled:!b}),X=W?.count??0,Z=W?.is_estimate?(0,M.formatEstimatedCount)(X):X.toLocaleString(),ee=Math.ceil(X/d.rowsPerPage),et=X>0?ee:1,{data:es,isPending:ei}=(0,u.useTableRowsQuery)({projectRef:l?.ref,connectionString:l?.connectionString,tableId:a,sorts:r,filters:o,page:m.page,limit:d.rowsPerPage,roleImpersonationState:g},{enabled:b&&e}),en=(es?.rows??[]).length<d.rowsPerPage,ea=()=>{j>1&&(m.selectedRows.size>=1?V(!0):er())},er=()=>{let e=j-1;m.setPage(e)},eo=()=>{let e=j+1;m.setPage(e)},el=e=>{let t=e>ee?ee:e;m.setPage(t||1)},ed=e=>{let t=Number(e);d.setRowsPerPage(isNaN(t)?100:t)};return((0,s.useEffect)(()=>{Q(String(j))},[j]),(0,s.useEffect)(()=>{!b&&j&&j>et&&m.setPage(et)},[b,j,et]),(0,s.useEffect)(()=>{void 0!==a&&m.setEnforceExactCount(null!==y&&y<=S.THRESHOLD_COUNT)},[a]),(0,s.useEffect)(()=>{G&&m.enforceExactCount&&J?.code===408&&m.setEnforceExactCount(!1)},[G,m.enforceExactCount,J?.code]),b)?(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(L.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(N.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:j<=1,onClick:ea}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(D.Input,{size:"tiny",className:"w-10",min:1,value:$,onChange:e=>Q(e.target.value),onKeyDown:e=>{let t=Number($);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&el(t)}}),(0,t.jsx)(L.Button,{"aria-label":"Next page",icon:(0,t.jsx)(C.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:en||!e,loading:ei&&e,onClick:eo}),(0,t.jsx)(O,{onRowsPerPageChange:ed})]}):(0,t.jsxs)("div",{className:"flex items-center gap-x-4",children:[H&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(R.Loader2,{size:12,className:"animate-spin"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Loading records count..."})]}),K&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(L.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(N.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:j<=1||H,onClick:ea}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(D.Input,{className:"w-12",size:"tiny",min:1,max:ee,value:$,onChange:e=>Q(e.target.value),onKeyDown:e=>{let t=Number($);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&t<=ee&&el(t)}}),(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",et.toLocaleString()]}),(0,t.jsx)(L.Button,{"aria-label":"Next page",icon:(0,t.jsx)(C.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:j>=ee||H,onClick:()=>{j<ee&&(m.selectedRows.size>=1?z(!0):eo())}}),(0,t.jsx)(O,{onRowsPerPageChange:ed})]}),!b&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:[`${Z} ${0===X||X>1?"records":"record"}`," ",W.is_estimate?"(estimated)":""]}),W.is_estimate&&(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(L.Button,{size:"tiny",type:"text",className:"px-1.5",loading:Y,icon:(0,t.jsx)(T.HelpCircle,{}),onClick:()=>{null===y||X>S.THRESHOLD_COUNT?q(!0):m.setEnforceExactCount(!0)}})}),(0,t.jsxs)(I.TooltipContent,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",S.THRESHOLD_COUNT.toLocaleString()," rows. ",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),G&&(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,t.jsx)(A.default,{visible:F,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>V(!1),onConfirm:()=>{er(),V(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(A.default,{visible:B,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>z(!1),onConfirm:()=>{eo(),z(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(A.default,{variant:"warning",visible:U,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>q(!1),onConfirm:()=>{m.setEnforceExactCount(!0),q(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:null===y?`If your table has a row count of greater than ${S.THRESHOLD_COUNT.toLocaleString()} rows,
          retrieving the exact count of the table may cause performance issues on your database.`:`Your table has a row count of greater than ${S.THRESHOLD_COUNT.toLocaleString()} rows, and
          retrieving the exact count of the table may cause performance issues on your database.`})})]})},z=({enableForeignRowsQuery:e=!0})=>{let{id:s}=(0,i.useParams)(),n=s?Number(s):void 0,{data:a}=(0,v.useSelectedProjectQuery)(),[r,o]=(0,b.useQueryState)("view",b.parseAsString.withDefault("data")),{data:l}=(0,w.useTableEditorQuery)({projectRef:a?.ref,connectionString:a?.connectionString,id:n}),d=(0,c.isViewLike)(l),u=(0,c.isTableLike)(l);return(0,t.jsxs)(j.GridFooter,{children:["data"===r&&(0,t.jsx)(B,{enableForeignRowsQuery:e}),(0,t.jsx)("div",{className:"ml-auto flex items-center gap-x-2",children:(d||u)&&(0,t.jsx)(y.default,{width:75,options:["definition","data"],activeOption:r,borderOverride:"border",onClickOption:o})})]})};var F=e.i(591385),V=e.i(991435),U=e.i(19583),q=e.i(687256),W=e.i(471994),H=e.i(311827),K=e.i(162082),G=e.i(265735),Y=e.i(323150),J=e.i(843778),X=e.i(108151),Z=e.i(356003),ee=e.i(355901),et=e.i(328675),es=e.i(513826),ei=e.i(790819),en=e.i(478145),ea=e.i(10429),er=e.i(567558),eo=e.i(937942),el=e.i(710483);let ed=({error:e})=>{let{filters:s}=(0,k.useTableFilter)(),{sorts:i}=(0,_.useTableSort)(),n=(0,x.useTableEditorTableStateSnapshot)(),a=n.originalTable?.entity_type===H.ENTITY_TYPE.FOREIGN_TABLE&&e?.message?.includes("query vault failed"),r=s.length>0&&e?.message?.includes("invalid input syntax"),o=i.length>0&&e?.message?.includes("identify an ordering operator");return a?(0,t.jsx)(ec,{}):r?(0,t.jsx)(eu,{error:e}):o?(0,t.jsx)(em,{error:e}):(0,t.jsx)(eh,{error:e})},ec=()=>{let{ref:e}=(0,i.useParams)(),{data:s}=(0,v.useSelectedProjectQuery)(),n=s?.parent_project_ref!==void 0;return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:"Failed to retrieve rows from foreign table",children:[(0,t.jsxs)("p",{children:["The key that's used to retrieve data from your foreign table is either incorrect or missing. Verify the key in your"," ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations?category=wrapper`,children:"wrapper's settings"})," ","or in ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"}),"."]}),n&&(0,t.jsxs)("p",{children:["Note: Vault keys from the main project do not sync to branches. You may add them manually into ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"})," ","if you want to query foreign tables while on a branch."]})]})},eu=({error:e})=>{let{onApplyFilters:s}=(0,k.useTableFilter)();return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:"Invalid input syntax provided in filter value(s)",children:[(0,t.jsx)("p",{className:"!mb-0",children:"Unable to retrieve results as the provided value in your filter(s) doesn't match it's column data type."}),(0,t.jsx)("p",{className:"!mb-2",children:"Verify that your filter values are correct before applying the filters again."}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(L.Button,{type:"default",onClick:()=>s([]),children:"Remove filters"})]})},em=({error:e})=>{let{sorts:s,onApplySorts:i}=(0,_.useTableSort)(),n=(e?.message??"").split("type ").pop(),a=n.includes("json")?n.toUpperCase():n;return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:`Sorting is not supporting on ${s.length>1?"one of the selected columns":"the selected column"}`,children:[(0,t.jsxs)("p",{className:"!mb-0",children:["Unable to retrieve results as sorting is not supported on"," ",s.length>1?"one of the selected columns":"the selected column"," due to its data type. (",a,")"]}),(0,t.jsxs)("p",{className:"!mb-2",children:["Remove any sorts on columns with the data type ",a," applying the sorts again."]}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(L.Button,{type:"default",onClick:()=>i([]),children:"Remove sorts"})]})},eh=({error:e})=>{let{filters:s}=(0,k.useTableFilter)();return(0,t.jsx)(er.default,{className:"pointer-events-auto",error:e,subject:"Failed to retrieve rows from table",children:s.length>0&&(0,t.jsx)("p",{children:"Verify that the filter values are correct, as the error may stem from an incorrectly applied filter"})})};var ep=e.i(840645),ex=e.i(701275);function eg(e,s){let{show:i}=(0,ep.useContextMenu)();return(0,t.jsx)(F.Row,{...s,onContextMenu:function(e){i(e,{id:ex.ROW_CONTEXT_MENU_ID,props:{rowIdx:s.rowIdx}})}},e)}let ef=e=>e?.idx??-1,eb=(0,s.memo)((0,s.forwardRef)(({width:e,height:i,containerClass:n,gridClass:a,rowClass:r,rows:o,error:l,isDisabled:d=!1,isLoading:u,isSuccess:m,isError:g},f)=>{let b=(0,p.useTableEditorStateSnapshot)(),j=(0,x.useTableEditorTableStateSnapshot)(),{filters:y,onApplyFilters:w}=(0,k.useTableFilter)(),{data:S}=(0,G.useSelectedOrganizationQuery)(),{data:N}=(0,v.useSelectedProjectQuery)(),C=function(e){let i=(0,Z.useQueryClient)(),{data:n}=(0,v.useSelectedProjectQuery)(),a=(0,x.useTableEditorTableStateSnapshot)(),r=(0,h.useGetImpersonatedRoleState)(),{mutate:o}=(0,en.useTableRowUpdateMutation)({async onMutate({projectRef:e,table:t,configuration:s,payload:n}){let a=new Set(Object.keys(s.identifiers)),r=ei.tableRowKeys.tableRows(e,{table:{id:t.id}});await i.cancelQueries({queryKey:r});let o=i.getQueriesData({queryKey:r});return i.setQueriesData({queryKey:r},e=>({rows:e?.rows.map(e=>Object.entries(e).filter(([e])=>a.has(e)).every(([e,t])=>t===s.identifiers[e])?{...e,...n}:e)??[]})),{previousRowsQueries:o}},onError(e,t,s){let{previousRowsQueries:n}=s;n.forEach(([e,t])=>{t&&i.setQueriesData({queryKey:e},t),i.invalidateQueries({queryKey:e})}),ee.toast.error(e?.message??e)}});return(0,s.useCallback)((s,i)=>{if(!n)return;let l=s[i.indexes[0]],d=e.find(e=>e.idx==l.idx),u=Object.keys(l).find(e=>l[e]!==d[e]);if(!d||!u)return;let m={[u]:l[u]},h=a.originalTable.columns?.filter(e=>(e?.enums??[]).length>0&&"array"===e.data_type.toLowerCase()).map(e=>e.name),p={};if((0,c.isTableLike)(a.originalTable)&&a.originalTable.primary_keys.forEach(e=>{let t=a.originalTable.columns.find(t=>t.name===e.name);p[e.name]=t?.format==="bytea"?(0,et.convertByteaToHex)(d[e.name]):d[e.name]}),0===Object.keys(p).length)return(0,ee.toast)("Unable to update row as table has no primary keys",{description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(es.DocsButton,{href:`${ea.DOCS_URL}/guides/database/tables#primary-keys`})})]})});o({projectRef:n.ref,connectionString:n.connectionString,table:a.originalTable,configuration:{identifiers:p},payload:m,enumArrayColumns:h,roleImpersonationState:r()})},[r,o,n,e,a.originalTable])}(o),T=(0,s.useRef)(null),R=j.page,E=j.table,_=j.originalTable?.entity_type,P=_===H.ENTITY_TYPE.FOREIGN_TABLE,I=0===(o??[]).length,{mutate:D}=(0,K.useSendEventMutation)(),{isValidFile:A,isDraggedOver:$,onDragOver:M,onFileDrop:Q}=function({enabled:e,onFileDropped:t,onTelemetryEvent:i}){let[n,a]=(0,s.useState)(!1),[r,o]=(0,s.useState)(!1),l=(0,s.useCallback)(t=>{if(!e)return;let[s]=t.dataTransfer.items;s&&"file"!==s.kind||("dragover"!==t.type||n?("dragleave"===t.type||"drop"===t.type)&&(a(!1),o(!1)):(a(!0),o("text/csv"===s.type)),t.stopPropagation(),t.preventDefault())},[e,n,r]),d=(0,s.useCallback)(s=>{if(!e)return;l(s);let[n]=s.dataTransfer.files,[a]=s.dataTransfer.items;a&&"file"!==a.kind||(0,Y.flagInvalidFileImport)(n)||(t(n),i?.("import_data_dropzone_file_added"))},[e,l,t,i]);return{isValidFile:r&&n,isDraggedOver:n,onDragOver:l,onFileDrop:d}}({enabled:I&&!P,onFileDropped:e=>b.onImportData((0,V.ref)(e)),onTelemetryEvent:e=>{D({action:e,groups:{project:N?.ref??"Unknown",organization:S?.slug??"Unknown"}})}}),{data:O}=(0,W.useForeignKeyConstraintsQuery)({projectRef:N?.ref,connectionString:N?.connectionString,schema:E?.schema??void 0});return(0,t.jsxs)("div",{className:(0,J.cn)("flex flex-col relative transition-colors",n),style:{width:e||"100%",height:i||"50vh"},children:[0===(o??[]).length&&(0,t.jsxs)("div",{className:(0,J.cn)("absolute top-9 p-2 w-full z-[1] pointer-events-none",I&&$&&"border-2 border-dashed",A?"border-brand-600":"border-destructive-600"),style:{height:"calc(100% - 35px)"},onDragOver:M,onDragLeave:M,onDrop:Q,children:[u&&!d&&(0,t.jsx)(X.GenericSkeletonLoader,{}),g&&(0,t.jsx)(ed,{error:l}),m&&(0,t.jsx)(t.Fragment,{children:R>1?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light",children:"This page does not have any data"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(L.Button,{type:"default",className:"pointer-events-auto",onClick:()=>j.setPage(1),children:"Head back to first page"})})]}):0===(y??[]).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:$?A?"Drop your CSV file here":(0,t.jsx)("span",{className:"text-destructive",children:"Only CSV files are accepted"}):"This table is empty"}),_===H.ENTITY_TYPE.FOREIGN_TABLE?(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"This table is a foreign table. Add data to the connected source to get started."})}):!$&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 mt-4",children:[(0,t.jsx)(L.Button,{type:"default",className:"pointer-events-auto",onClick:()=>{b.onImportData(),D({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:N?.ref??"Unknown",organization:S?.slug??"Unknown"}})},children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light pointer-events-auto",children:"or drag and drop a CSV file here"})]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"The filters applied have returned no results from this table"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(L.Button,{type:"default",className:"pointer-events-auto",onClick:()=>w([]),children:"Remove all filters"})})]})})]}),(0,t.jsx)(F.default,{ref:f,className:`${a} flex-grow`,rowClass:r,columns:j.gridColumns,rows:o??[],renderers:{renderRow:eg},rowKeyGetter:ef,selectedRows:j.selectedRows,onColumnResize:j.updateColumnSize,onRowsChange:C,onSelectedCellChange:function(e){T.current=e,j.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){j.setSelectedRows(e)},onCellDoubleClick:e=>{var t,s;let i;return t=e.row,void((i=function(e){let{targetTableSchema:t,targetTableName:s,targetColumnName:i}=E?.columns.find(t=>t.name==e)?.foreignKey??{},n=O?.find(n=>n.source_schema===E?.schema&&n.source_table===E?.name&&n.source_columns.includes(e)&&n.target_schema===t&&n.target_table===s&&n.target_columns.includes(i??""));return void 0!==n?(0,q.formatForeignKeys)([n])[0]:void 0}((s=e.column).name))&&b.onEditForeignKeyColumnValue({foreignKey:i,row:t,column:s}))},onCellKeyDown:U.handleCopyCell})]})}));var ej=e.i(749844),ey=e.i(88816),ew=e.i(291969),ev=e.i(211570),eS=e.i(924115),eN=e.i(250503),eC=e.i(731228),eT=e.i(82394),eR=e.i(701087),eE=e.i(847948),ek=e.i(826843),e_=e.i(284399),eP=e.i(503348),eL=e.i(525070),eI=e.i(215312),eD=e.i(302372),eA=e.i(321605),e$=e.i(587768),eM=e.i(534587),eQ=e.i(438824),eO=e.i(847278),eB=e.i(2579),ez=e.i(912793),eF=e.i(394058),eV=e.i(392491),eU=e.i(967052),eq=e.i(793912),eW=e.i(135144),eH=e.i(689805),eK=e.i(686415),eG=e.i(242882),eY=e.i(714403),eJ=e.i(246230);async function eX({projectRef:e,connectionString:t,id:s},i){let n=(({id:e})=>{if(!e)throw Error("id is required");return`
    with table_info as (
      select 
        n.nspname::text as schema,
        c.relname::text as name,
        to_regclass(concat('"', n.nspname, '"."', c.relname, '"')) as regclass
      from pg_class c
      join pg_namespace n on n.oid = c.relnamespace
      where c.oid = ${e}
    )
    select pg_get_viewdef(t.regclass, true) as definition
    from table_info t
  `.trim()})({id:s}),{result:a}=await (0,eY.executeSql)({projectRef:e,connectionString:t,sql:n,queryKey:["view-definition",s]},i);return a[0].definition.trim()}let eZ=({projectRef:e,connectionString:t,id:s},{enabled:i=!0,...n}={})=>(0,eG.useQuery)({queryKey:eJ.databaseKeys.viewDefinition(e,s),queryFn:({signal:i})=>eX({projectRef:e,connectionString:t,id:s},i),enabled:i&&void 0!==e&&void 0!==s&&!isNaN(s),...n});var e0=e.i(915993),e1=e.i(617361),e2=e.i(396831),e5=e.i(200243);function e4({table:e,isAutofixViewSecurityModalOpen:s,setIsAutofixViewSecurityModalOpen:i}){let{data:n}=(0,v.useSelectedProjectQuery)(),a=(0,Z.useQueryClient)(),{isSuccess:r,isPending:o,data:l}=eZ({id:e?.id,projectRef:n?.ref,connectionString:n?.connectionString},{enabled:s&&(0,c.isViewLike)(e)}),{mutate:d}=(0,e1.useExecuteSqlMutation)({onSuccess:async()=>{ee.toast.success("View security changed successfully"),i(!1),await a.invalidateQueries({queryKey:e0.lintKeys.lint(n?.ref)})},onError:e=>{ee.toast.error(`Failed to autofix view security: ${e.message}`)}});return(0,c.isViewLike)(e)?(0,t.jsxs)(A.default,{visible:s,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>i(!1),onConfirm:()=>{let t;return t=`
	ALTER VIEW "${e.schema}"."${e.name}" SET (security_invoker = on);
	`,void d({projectRef:n?.ref,connectionString:n?.connectionString,sql:t})},children:[(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,t.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,t.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,t.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,t.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,t.jsxs)(e2.ScrollArea,{className:"h-[225px] px-4 py-2",children:[o&&(0,t.jsx)(X.GenericSkeletonLoader,{}),r&&(0,t.jsx)(e5.SimpleCodeBlock,{children:`create view ${e.schema}.${e.name} as
 ${l}`})]})]}),(0,t.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,t.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,t.jsxs)(e2.ScrollArea,{className:"h-[225px] px-4 py-2",children:[o&&(0,t.jsx)(X.GenericSkeletonLoader,{}),r&&(0,t.jsx)(e5.SimpleCodeBlock,{children:`create view ${e.schema}.${e.name} with (security_invoker = on) as
 ${l}`})]})]})]})]}):null}let e3=({table:e,isRefetching:r})=>{let{ref:o}=(0,i.useParams)(),{data:l}=(0,v.useSelectedProjectQuery)(),d=(0,eU.useTrack)(),[u,m]=(0,b.useQueryState)("showWarning",b.parseAsBoolean.withDefault(!1)),{data:h=[]}=(0,eQ.useProjectLintsQuery)({projectRef:l?.ref}),{isAvailable:p,isEnabled:g}=(0,ek.useTableIndexAdvisor)(),f=(0,c.isTableLike)(e),j=(0,c.isForeignTable)(e),y=(0,c.isView)(e),w=(0,c.isMaterializedView)(e),{realtimeAll:S}=(0,ez.useIsFeatureEnabled)(["realtime:all"]),{isSchemaLocked:N}=(0,eV.useIsProtectedSchema)({schema:e.schema}),{mutate:C,isPending:T}=(0,eO.useTableUpdateMutation)({onError:e=>{ee.toast.error(`Failed to toggle RLS: ${e.message}`)},onSettled:()=>{el()}}),[R,E]=(0,s.useState)(!1),[k,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)(!1),$=0===(0,x.useTableEditorTableStateSnapshot)().selectedRows.size,M=l?.ref,{data:Q}=(0,eD.useDatabasePoliciesQuery)({projectRef:l?.ref,connectionString:l?.connectionString}),O=(Q??[]).filter(t=>t.schema===e.schema&&t.table===e.name),{data:B}=(0,eA.useDatabasePublicationsQuery)({projectRef:l?.ref,connectionString:l?.connectionString}),z=(B??[]).find(e=>"supabase_realtime"===e.name),F=z?.tables??[],V=F.some(t=>t.id===e?.id),{activeVariant:U}=(0,eF.useRealtimeExperiment)({projectInsertedAt:l?.inserted_at,isTable:f,isRealtimeEnabled:V}),{mutate:q,isPending:W}=(0,e$.useDatabasePublicationUpdateMutation)({onSuccess:()=>{E(!1),d(V?"table_realtime_disabled":"table_realtime_enabled",{method:"ui",schema_name:e.schema,table_name:e.name})},onError:t=>{ee.toast.error(`Failed to toggle realtime for ${e.name}: ${t.message}`)}}),{data:H}=(0,eM.useDatabaseTriggersQuery)({projectRef:l?.ref,connectionString:l?.connectionString},{enabled:f}),K=(H??[]).filter(t=>t.schema===e.schema&&t.table===e.name).length,{can:G,isLoading:Y}=(0,eB.useAsyncCheckPermissions)(n.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{can:X}=(0,eB.useAsyncCheckPermissions)(n.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),Z="public"===e.schema,{hasLint:et,matchingLint:es}=(0,eP.getEntityLintDetails)(e.name,"security_definer_view",["ERROR","WARN"],h,e.schema),{hasLint:ei,matchingLint:en}=(0,eP.getEntityLintDetails)(e.name,"materialized_view_in_api",["ERROR","WARN"],h,e.schema),er=`/project/${o}/database/triggers?schema=${e.schema}`,eo=async()=>{if(!l||!z)return;let t=F.some(t=>t.id===e.id),s=t?F.filter(t=>t.id!==e.id).map(e=>`${e.schema}.${e.name}`):[`${e.schema}.${e.name}`].concat(F.map(e=>`${e.schema}.${e.name}`));d("realtime_toggle_table_clicked",{newState:t?"disabled":"enabled",origin:"tableGridHeader"}),q({projectRef:l?.ref,connectionString:l?.connectionString,id:z.id,tables:s})},el=()=>{_(!1)},ed=async()=>{let t={id:e.id,rls_enabled:!(f&&e.rls_enabled)};C({projectRef:l?.ref,connectionString:l?.connectionString,id:e.id,name:e.name,schema:e.schema,payload:t}),d("table_rls_enabled",{method:"table_editor",schema_name:e.schema,table_name:e.name})};return(0,t.jsxs)("div",{className:"sb-grid-header__inner",children:[$&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[!Y&&!G&&!X&&(0,t.jsxs)(I.Tooltip,{children:[(0,t.jsx)(I.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,t.jsx)(I.TooltipContent,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),f&&!N?e.rls_enabled?(0,t.jsx)(t.Fragment,{children:O.length<1&&!N?(0,t.jsx)(eI.ButtonTooltip,{asChild:!0,type:"default",className:"group",icon:(0,t.jsx)(eT.PlusCircle,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,t.jsx)(a.default,{passHref:!0,href:`/project/${M}/auth/policies?search=${e.name}&schema=${e.schema}`,children:"Add RLS policy"})}):(0,t.jsx)(L.Button,{asChild:!0,type:O.length<1&&!N?"warning":"default",className:"group",icon:N||O.length>0?(0,t.jsx)("div",{className:(0,J.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",O.length>9?" px-1":"w-[16px]",""),children:(0,t.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:O.length})}):(0,t.jsx)(eT.PlusCircle,{strokeWidth:1.5}),children:(0,t.jsxs)(a.default,{passHref:!0,href:`/project/${M}/auth/policies?search=${e.name}&schema=${e.schema}`,children:["RLS ",O.length>1?"policies":"policy"]})})}):(0,t.jsxs)(eH.Popover_Shadcn_,{modal:!1,open:u,onOpenChange:m,children:[(0,t.jsx)(eW.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"danger",icon:(0,t.jsx)(eN.Lock,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,t.jsxs)(eq.PopoverContent_Shadcn_,{portal:!0,className:"w-80 text-sm",align:"end",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,t.jsx)(eN.Lock,{size:16})," Row Level Security (RLS)"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-xs",children:[(0,t.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,t.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!N&&(0,t.jsx)(L.Button,{type:"default",className:"mt-2 w-min",onClick:()=>_(!k),children:"Enable RLS for this table"})]})]})]}):null,f&&p&&!g&&(0,t.jsxs)(eH.Popover_Shadcn_,{modal:!1,children:[(0,t.jsx)(eW.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"default",icon:(0,t.jsx)(eS.Lightbulb,{strokeWidth:1.5}),children:"Index Advisor"})}),(0,t.jsxs)(eq.PopoverContent_Shadcn_,{portal:!0,className:"w-80 text-sm",align:"end",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,t.jsx)(eS.Lightbulb,{size:16})," Index Advisor"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-xs",children:[(0,t.jsx)("p",{children:"Index Advisor recommends indexes to improve query performance on this table."}),(0,t.jsx)("p",{children:"Enable Index Advisor to get recommendations based on your actual query patterns."}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(e_.EnableIndexAdvisorButton,{})})]})]})]}),f&&U===eF.RealtimeButtonVariant.TRIGGERS?(0,t.jsx)(L.Button,{asChild:!0,type:"default",size:"tiny",icon:(0,t.jsx)("div",{className:(0,J.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",K>9?"px-1":"w-[16px]"),children:(0,t.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:K})}),children:(0,t.jsx)(a.default,{href:er,children:1===K?"Trigger":"Triggers"})}):U!==eF.RealtimeButtonVariant.HIDE_BUTTON&&S&&(0,t.jsx)(eI.ButtonTooltip,{type:"default",size:"tiny",icon:(0,t.jsx)(eC.MousePointer2,{strokeWidth:1.5,className:V?"text-brand":"text-foreground-muted"}),onClick:()=>E(!0),className:(0,J.cn)(V&&"w-7 h-7 p-0 text-brand hover:text-brand-hover"),tooltip:{content:{side:"bottom",text:V?"Click to disable realtime for this table":"Click to enable realtime for this table"}},children:!V&&"Enable Realtime"}),y&&et&&(0,t.jsxs)(eH.Popover_Shadcn_,{modal:!1,open:u,onOpenChange:m,children:[(0,t.jsx)(eW.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"warning",icon:(0,t.jsx)(eR.Unlock,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,t.jsxs)(eq.PopoverContent_Shadcn_,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(eR.Unlock,{size:16})," Secure your View"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,t.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)(L.Button,{type:"secondary",onClick:()=>{D(!0)},children:"Autofix"}),(0,t.jsx)(L.Button,{type:"default",asChild:!0,children:(0,t.jsx)(a.default,{target:"_blank",href:`/project/${o}/advisors/security?preset=${es?.level}&id=${es?.cache_key}`,children:"Learn more"})})]})]})]})]}),w&&ei&&(0,t.jsxs)(eH.Popover_Shadcn_,{modal:!1,open:u,onOpenChange:m,children:[(0,t.jsx)(eW.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"warning",icon:(0,t.jsx)(eR.Unlock,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,t.jsxs)(eq.PopoverContent_Shadcn_,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(eR.Unlock,{size:16})," Secure your View"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,t.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(L.Button,{type:"default",asChild:!0,children:(0,t.jsx)(a.default,{target:"_blank",href:`/project/${o}/advisors/security?preset=${en?.level}&id=${en?.cache_key}`,children:"Learn more"})})})]})]})]}),j&&"public"===e.schema&&(0,t.jsxs)(eH.Popover_Shadcn_,{modal:!1,open:u,onOpenChange:m,children:[(0,t.jsx)(eW.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"warning",icon:(0,t.jsx)(eR.Unlock,{strokeWidth:1.5}),children:"Unprotected Data API access"})}),(0,t.jsxs)(eq.PopoverContent_Shadcn_,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(eR.Unlock,{size:16})," Secure Foreign table"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsxs)("p",{children:["Foreign tables do not enforce RLS, which may allow unrestricted access. To secure them, either move foreign tables to a private schema not exposed by PostgREST, or ",(0,t.jsx)("a",{href:"",children:"disable PostgREST access"})," entirely."]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(L.Button,{type:"default",asChild:!0,children:(0,t.jsx)(a.default,{target:"_blank",href:`${ea.DOCS_URL}/guides/database/extensions/wrappers/overview#security`,children:"Learn more"})})})]})]})]}),(0,t.jsx)(eK.RoleImpersonationPopover,{serviceRoleLabel:"postgres"}),Z&&(0,t.jsx)(eL.APIDocsButton,{section:["entities",e.name],source:"table_editor"}),(0,t.jsx)(eE.RefreshButton,{tableId:e.id,isRefetching:r})]}),(0,t.jsx)(A.default,{visible:R,loading:W,title:`${V?"Disable":"Enable"} realtime for ${e.name}`,confirmLabel:`${V?"Disable":"Enable"} realtime`,confirmLabelLoading:`${V?"Disabling":"Enabling"} realtime`,onCancel:()=>E(!1),onConfirm:()=>eo(),children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",V?"disabled":"enabled",", the table will"," ",V?"no longer ":"","broadcast any changes to authorized subscribers."]}),!V&&(0,t.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,t.jsx)(a.default,{href:`/project/${o}/database/publications`,className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,t.jsx)(e4,{table:e,isAutofixViewSecurityModalOpen:P,setIsAutofixViewSecurityModalOpen:D}),f&&(0,t.jsx)(A.default,{visible:k,variant:e.rls_enabled?"destructive":"default",title:`${e.rls_enabled?"Disable":"Enable"} Row Level Security`,description:`Are you sure you want to ${e.rls_enabled?"disable":"enable"} Row Level Security for this table?`,confirmLabel:`${e.rls_enabled?"Disable":"Enable"} RLS`,confirmLabelLoading:`${e.rls_enabled?"Disabling":"Enabling"} RLS`,loading:T,onCancel:el,onConfirm:ed})]})};var e8=e.i(534517),e9=e.i(375761),e6=e.i(874311),e7=e.i(479095),te=e.i(73011),tt=e.i(816232);let ts=({portal:e=!0})=>{let{urlFilters:i,onApplyFilters:n}=(0,k.useTableFilter)(),a=(0,s.useMemo)(()=>(0,U.formatFilterURLParams)(i??[]),[i]);return(0,t.jsx)(tt.FilterPopoverPrimitive,{portal:e,filters:a,onApplyFilters:n})};var ti=e.i(586468),tn=e.i(626915);let ta=({portal:e=!0,tableQueriesEnabled:i})=>{let{urlSorts:n,onApplySorts:a}=(0,_.useTableSort)(),r=(0,x.useTableEditorTableStateSnapshot)(),o=r.table?.name||"",l=(0,s.useMemo)(()=>o&&n?(0,U.formatSortURLParams)(o,n):[],[o,n]);return(0,t.jsx)(tn.SortPopoverPrimitive,{portal:e,sorts:l,onApplySorts:a,tableQueriesEnabled:i})},tr=({customHeader:e,isRefetching:s,tableQueriesEnabled:i=!0})=>{let n=(0,x.useTableEditorTableStateSnapshot)();return(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[e||(n.selectedRows.size>0?(0,t.jsx)(tl,{tableQueriesEnabled:i}):(0,t.jsx)(to,{tableQueriesEnabled:i})),(0,t.jsx)(e3,{table:n.originalTable,isRefetching:s})]})})},to=({tableQueriesEnabled:e=!0})=>{let{ref:s}=(0,i.useParams)(),{data:a}=(0,G.useSelectedOrganizationQuery)(),r=(0,x.useTableEditorTableStateSnapshot)(),o=(0,p.useTableEditorStateSnapshot)(),{can:l}=(0,eB.useAsyncCheckPermissions)(n.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:d}=(0,K.useSendEventMutation)(),c=r.editable&&(r.table.columns??[]).length>0?o.onAddRow:void 0,u=r.editable?o.onAddColumn:void 0,m=r.editable?o.onImportData:void 0;return(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ts,{}),(0,t.jsx)(ta,{tableQueriesEnabled:e})]}),(void 0!==c||void 0!==u)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:l&&(0,t.jsxs)(e6.DropdownMenu,{children:[(0,t.jsx)(e6.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(L.Button,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,t.jsx)(ey.ChevronDown,{strokeWidth:1.5}),children:"Insert"})}),(0,t.jsx)(e6.DropdownMenuContent,{side:"bottom",align:"start",children:[...void 0!==c?[(0,t.jsxs)(e6.DropdownMenuItem,{className:"group space-x-2",onClick:c,children:[(0,t.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,t.jsx)("div",{className:(0,J.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert row"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",r.table.name]})]})]},"add-row")]:[],...void 0!==u?[(0,t.jsxs)(e6.DropdownMenuItem,{className:"group space-x-2",onClick:u,children:[(0,t.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,t.jsx)("div",{className:(0,J.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert column"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",r.table.name]})]})]},"add-column")]:[],...void 0!==m?[(0,t.jsxs)(e6.DropdownMenuItem,{className:"group space-x-2",onClick:()=>{m(),d({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:s??"Unknown",organization:a?.slug??"Unknown"}})},children:[(0,t.jsxs)("div",{className:"relative -mt-2",children:[(0,t.jsx)(ew.FileText,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,t.jsx)(ej.ArrowUp,{className:(0,J.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},tl=({tableQueriesEnabled:e=!0})=>{let{data:i}=(0,v.useSelectedProjectQuery)(),n=(0,p.useTableEditorStateSnapshot)(),a=(0,x.useTableEditorTableStateSnapshot)(),r=(0,h.useRoleImpersonationStateSnapshot)(),o=void 0!==r.role,{filters:l}=(0,k.useTableFilter)(),{sorts:d}=(0,_.useTableSort)(),[c,m]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),{data:b}=(0,u.useTableRowsQuery)({projectRef:i?.ref,connectionString:i?.connectionString,tableId:a.table.id,sorts:d,filters:l,page:a.page,limit:n.rowsPerPage,roleImpersonationState:r},{enabled:e}),{data:j}=(0,P.useTableRowsCountQuery)({projectRef:i?.ref,connectionString:i?.connectionString,tableId:a.table.id,filters:l,enforceExactCount:a.enforceExactCount,roleImpersonationState:r},{placeholderData:E.keepPreviousData,enabled:e}),y=b?.rows??[],w=j?.count??0,S=e=>{let t=y.filter(e=>a.selectedRows.has(e.idx));if("csv"===e){let e=(({rows:e,columns:t})=>{let s=e.map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));return ti.default.unparse(s,{columns:t})})({rows:t,columns:a.table.columns.map(e=>e.name)});(0,e9.copyToClipboard)(e)}else if("sql"===e){let e=(0,eP.formatTableRowsToSQL)(a.table,t);(0,e9.copyToClipboard)(e)}else"json"===e&&(0,e9.copyToClipboard)(JSON.stringify(t));ee.toast.success("Copied rows to clipboard")},N=a.allRowsSelected?{type:"fetch_all",filters:l,sorts:d}:{type:"provided_rows",table:a.table,rows:y.filter(e=>a.selectedRows.has(e.idx))},{exportCsv:C,confirmationModal:T}=(0,e8.useExportAllRowsAsCsv)(i?{enabled:!0,projectRef:i.ref,connectionString:i?.connectionString??null,entity:a.table,totalRows:w,...N}:{enabled:!1}),R=async()=>{if(m(!0),!i)return ee.toast.error("Project is required"),m(!1);C(),m(!1)},{exportSql:I,confirmationModal:D}=(0,e8.useExportAllRowsAsSql)(i?{enabled:!0,projectRef:i.ref,connectionString:i?.connectionString??null,entity:a.table,...N}:{enabled:!1}),A=async()=>{if(m(!0),!i)return ee.toast.error("Project is required"),m(!1);I(),m(!1)},{exportJson:$,confirmationModal:M}=(0,e8.useExportAllRowsAsJson)(i?{enabled:!0,projectRef:i.ref,connectionString:i?.connectionString??null,entity:a.table,...N}:{enabled:!1}),Q=async()=>{if(!i)return ee.toast.error("Project is required");m(!0),$(),m(!1)};return(0,h.useSubscribeToImpersonatedRole)(()=>{(a.allRowsSelected||a.selectedRows.size>0)&&a.setSelectedRows(new Set)}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[a.editable&&(0,t.jsx)(eI.ButtonTooltip,{type:"default",size:"tiny",icon:(0,t.jsx)(ev.Trash,{}),onClick:()=>{let e=a.allRowsSelected?w:a.selectedRows.size,t=Array.from(a.selectedRows),s=y.filter(e=>t.includes(e.idx));n.onDeleteRows(s,{allRowsSelected:a.allRowsSelected,numRows:e,callback:()=>{a.setSelectedRows(new Set)}})},disabled:a.allRowsSelected&&o,tooltip:{content:{side:"bottom",text:a.allRowsSelected&&o?"Table truncation is not supported when impersonating a role":void 0}},children:a.allRowsSelected?"Delete all rows in table":a.selectedRows.size>1?`Delete ${a.selectedRows.size} rows`:`Delete ${a.selectedRows.size} row`}),a.allRowsSelected?(0,t.jsx)(eI.ButtonTooltip,{disabled:!0,type:"default",tooltip:{content:{side:"bottom",className:"w-64 text-center",text:"Copy to clipboard is not supported while all rows in the table are selected"}},children:"Copy"}):(0,t.jsxs)(e6.DropdownMenu,{children:[(0,t.jsx)(e6.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(ey.ChevronDown,{}),loading:c,disabled:c,children:"Copy"})}),(0,t.jsxs)(e6.DropdownMenuContent,{align:"start",className:"w-40",children:[(0,t.jsx)(e6.DropdownMenuItem,{onClick:()=>S("csv"),children:"Copy as CSV"}),(0,t.jsx)(e6.DropdownMenuItem,{onClick:()=>S("sql"),children:"Copy as SQL"}),(0,t.jsx)(e6.DropdownMenuItem,{onClick:()=>S("json"),children:"Copy as JSON"})]})]}),(0,t.jsxs)(e6.DropdownMenu,{children:[(0,t.jsx)(e6.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(L.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(ey.ChevronDown,{}),loading:c,disabled:c,children:"Export"})}),(0,t.jsxs)(e6.DropdownMenuContent,{align:"start",className:a.allRowsSelected?"w-52":"w-40",children:[(0,t.jsx)(e6.DropdownMenuItem,{onClick:R,children:"Export as CSV"}),(0,t.jsx)(e6.DropdownMenuItem,{onClick:A,children:"Export as SQL"}),a.allRowsSelected?(0,t.jsx)(e6.DropdownMenuItem,{className:"group",onClick:()=>f(!0),children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,t.jsx)(e6.DropdownMenuItem,{onClick:Q,children:"Export as JSON"})]})]}),!a.allRowsSelected&&w>y.length&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-6 ml-0.5",children:(0,t.jsx)(e7.Separator,{orientation:"vertical"})}),(0,t.jsx)(L.Button,{type:"text",onClick:()=>void a.setSelectedRows(new Set(y.map(e=>e.idx)),!0),children:"Select all rows in table"})]})]}),(0,t.jsx)(te.ExportDialog,{table:a.table,filters:l,sorts:d,open:g,onOpenChange:()=>f(!1)}),T,D,M]})};var td=e.i(816467),tc=e.i(53071),tu=e.i(253214),tm=e.i(607764);let th=({rows:e})=>{let i=(0,p.useTableEditorStateSnapshot)(),n=(0,x.useTableEditorTableStateSnapshot)(),a=(0,s.useCallback)(t=>{let s=t.props?.rowIdx;if(!n.selectedCellPosition||null==s)return;let i=e[s][n.gridColumns[n.selectedCellPosition.idx].key],a=(0,tm.formatClipboardValue)(i);(0,e9.copyToClipboard)(a),ee.toast.success("Copied cell value to clipboard")},[e,n.gridColumns,n.selectedCellPosition]),r=(0,s.useCallback)(t=>{let s=t.props?.rowIdx;if(null==s)return;let i=e[s];(0,e9.copyToClipboard)(JSON.stringify(i)),ee.toast.success("Copied row to clipboard")},[e]);return(0,t.jsxs)(ep.Menu,{id:ex.ROW_CONTEXT_MENU_ID,animation:!1,className:"!min-w-36",children:[(0,t.jsxs)(ep.Item,{onClick:a,children:[(0,t.jsx)(td.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell"})]}),(0,t.jsxs)(ep.Item,{onClick:r,children:[(0,t.jsx)(td.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy row"})]}),n.editable&&(0,t.jsx)(tu.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(ep.Item,{onClick:function(t){let s=t.props?.rowIdx;if(null==s)return;let n=e[s];i.onEditRow(n)},hidden:!n.editable,data:"edit",children:[(0,t.jsx)(tc.Edit,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),n.editable&&(0,t.jsx)(tu.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(ep.Item,{onClick:function(t){let s=t.props?.rowIdx;if(null==s)return;let n=e[s];n&&i.onDeleteRows([n])},hidden:!n.editable,data:"delete",children:[(0,t.jsx)(ev.Trash,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})},tp=({title:e,children:s})=>(0,t.jsx)("div",{className:"mt-2 px-3 pb-2",children:(0,t.jsx)(el.Admonition,{type:"warning",title:e,description:s})}),tx=()=>(0,t.jsx)(tp,{title:"Cannot sort by filtered column",children:'Sorting only by columns filtered with "=" or "is" doesn\'t work on MSSQL tables. Pick a different sorting column, or add a column not in your filter.'}),tg=()=>(0,t.jsx)(tp,{title:"No valid sort column remaining",children:'All columns that can be sorted have been filtered with "=" or "is", which doesn\'t work on MSSQL tables. Remove a column from your filter to continue.'}),tf=({customHeader:e,gridProps:n,children:a})=>{let{id:r}=(0,i.useParams)(),g=r?Number(r):void 0,{data:b}=(0,v.useSelectedProjectQuery)(),j=(0,p.useTableEditorStateSnapshot)(),y=(0,x.useTableEditorTableStateSnapshot)(),w=(0,s.useRef)(null),[S,N]=(0,s.useState)(!1),{filters:C}=(0,k.useTableFilter)(),{sorts:T,onApplySorts:R}=(0,_.useTableSort)(),P=(0,h.useRoleImpersonationStateSnapshot)(),L=(0,c.isMsSqlForeignTable)(y.originalTable)?(({filters:e,sorts:t,table:s})=>{if(!(0,c.isMsSqlForeignTable)(s))return{warning:null};let i=new Set(e.filter(e=>"="===e.operator||"is"===e.operator).map(e=>e.column)),n=t.length>0&&t.every(e=>i.has(e.column));if(i.size>0&&n)return{warning:"ConflictingSort",Component:tx};let a=s.columns.length>0&&s.columns.every(e=>"json"===e.data_type||i.has(e.name));return e.length>0&&a?{warning:"NoValidSortPossible",Component:tg}:{warning:null}})({filters:C,sorts:T,table:y.originalTable}):{warning:null},I=null===L.warning,{data:D,error:A,isSuccess:$,isError:M,isPending:Q,isRefetching:O}=(0,u.useTableRowsQuery)({projectRef:b?.ref,connectionString:b?.connectionString,tableId:g,sorts:T,filters:C,page:y.page,limit:j.rowsPerPage,roleImpersonationState:P},{placeholderData:E.keepPreviousData,enabled:I,retry:(e,t)=>(t&&t.message?.includes("does not exist")&&R([]),!1)});(0,s.useEffect)(()=>{S||N(!0)},[]);let B=D?.rows??m.EMPTY_ARR;return(0,t.jsx)(o.DndProvider,{backend:l.HTML5Backend,context:window,children:(0,t.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,t.jsx)(tr,{customHeader:e,isRefetching:O,tableQueriesEnabled:I}),null!==L.warning&&(0,t.jsx)(L.Component,{}),a||(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eb,{ref:w,...n,rows:B,error:A,isDisabled:!I,isLoading:Q,isSuccess:$,isError:M}),(0,t.jsx)(z,{enableForeignRowsQuery:I}),(0,t.jsx)(f,{gridRef:w,rows:B})]}),S&&(0,d.createPortal)((0,t.jsx)(th,{rows:B}),document.body)]})})};var tb=e.i(990510),tj=e.i(983783),ty=e.i(238944),tw=e.i(63519),tv=e.i(290623),tS=e.i(565066),tN=e.i(156054),tC=e.i(896975),tT=e.i(487164),tR=e.i(887093),tE=e.i(48189);let tk=({entity:e})=>{let{ref:n}=(0,i.useParams)(),r=(0,s.useRef)(null),o=(0,s.useRef)(null),{resolvedTheme:l}=(0,tC.useTheme)(),{data:d}=(0,v.useSelectedProjectQuery)(),u=eZ({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isViewLike)(e)}),m=(0,tT.useTableDefinitionQuery)({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isTableLike)(e)}),{data:h,isLoading:p}=(0,c.isViewLike)(e)?u:m,x=(0,c.isView)(e)?`create view ${e.schema}.${e.name} as
`:(0,c.isMaterializedView)(e)?`create materialized view ${e.schema}.${e.name} as
`:"",g=(0,s.useMemo)(()=>h?(0,tR.formatSql)(x+h):void 0,[h]),f=async(e,t)=>{r.current=e,o.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,tE.timeout)(500),e?.focus()};return p?(0,t.jsxs)("div",{className:"h-full grid",children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(X.GenericSkeletonLoader,{})}),(0,t.jsx)("div",{className:"mt-auto",children:(0,t.jsx)(z,{})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,t.jsx)(L.Button,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,t.jsx)(a.default,{href:`/project/${n}/sql/new?content=${encodeURIComponent(g??"")}`,children:"Open in SQL Editor"})}),(0,t.jsx)(tN.default,{className:"monaco-editor",theme:l?.includes("dark")?"vs-dark":"vs",onMount:f,defaultLanguage:"pgsql",value:g,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]}),(0,t.jsx)(z,{})]})},t_=({isLoadingSelectedTable:e=!1,selectedTable:o})=>{let l=(0,r.useRouter)(),{ref:d,id:u}=(0,i.useParams)(),{setLastVisitedTable:m}=(0,tb.useDashboardHistory)(),{selectedSchema:h}=(0,tj.useQuerySchemaState)(),p=(0,tw.useTabsStateSnapshot)();(0,U.useSyncTableEditorStateFromLocalStorageWithUrl)({projectRef:d,table:o});let[{view:g="data"}]=(0,ty.useUrlState)(),{can:f}=(0,eB.useAsyncCheckPermissions)(n.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{can:b}=(0,eB.useAsyncCheckPermissions)(n.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),j=u?p.openTabs.find(e=>e.endsWith(u)):void 0,y=p.openTabs.filter(e=>!e.startsWith("sql")),w=(0,s.useCallback)(e=>{l.push(`/project/${d}/editor/${e.id}${h?`?schema=${h}`:""}`)},[d,l]),v=(0,s.useCallback)(async()=>{if(o){let e=(0,tw.createTabId)(o.entity_type,{id:o.id});p.handleTabClose({id:e,router:l,editor:"table",onClearDashboardHistory:()=>m(void 0)})}},[l,o,p]),{isSchemaLocked:S}=(0,eV.useIsProtectedSchema)({schema:o?.schema??""});if(e||!d)return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"h-10 bg-dash-sidebar dark:bg-surface-100"}),(0,t.jsx)("div",{className:"h-9 border-y"}),(0,t.jsx)("div",{className:"p-2 col-span-full",children:(0,t.jsx)(X.GenericSkeletonLoader,{})})]});let N=(0,c.isView)(o)||(0,c.isMaterializedView)(o),C=(0,c.isTableLike)(o),T=(0,c.isForeignTable)(o),R=!(!f&&!b)&&C&&!S,E=o?`${o.schema}_${o.name}`:"unknown-table";return(0,t.jsxs)("div",{className:"h-full",onClick:()=>p.makeActiveTabPermanent(),children:[o?(0,t.jsxs)(x.TableEditorTableStateContextProvider,{projectRef:d,table:o,editable:R,children:[(0,t.jsx)(tf,{gridProps:{height:"100%"},customHeader:(N||C)&&"definition"===g?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("p",{children:["SQL Definition of ",(0,t.jsx)("code",{className:"text-sm",children:o.name})," "]}),(0,t.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(N||C)&&"definition"===g&&(0,t.jsx)(tk,{entity:o})},E),(0,t.jsx)(tv.default,{selectedTable:C?o:void 0,onTableDeleted:v})]},`table-editor-table-${o.id}`):(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-[400px]",children:(0,t.jsx)(el.Admonition,{type:"default",title:`Unable to find your table with ID ${u}`,description:"This table doesn't exist in your database",children:j?(0,t.jsx)(L.Button,{type:"default",className:"mt-2",onClick:()=>{p.handleTabClose({id:j,router:l,editor:"table",onClearDashboardHistory:()=>m(void 0)})},children:"Close tab"}):y.length>0?(0,t.jsx)(L.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m(void 0),children:(0,t.jsx)(a.default,{href:`/project/${d}/editor/${y[0].split("-")[1]}`,children:"Close tab"})}):(0,t.jsx)(L.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m(void 0),children:(0,t.jsx)(a.default,{href:`/project/${d}/editor`,children:"Head back"})})})})}),(0,t.jsx)(tS.SidePanelEditor,{editable:R,selectedTable:C||T?o:void 0,onTableCreated:w})]})};var tP=e.i(448710),tL=e.i(569715),tI=e.i(111331),tD=e.i(207831);let tA=()=>{let{id:e,ref:n}=(0,i.useParams)(),a=e?Number(e):void 0,r=(0,tw.useTabsStateSnapshot)(),{data:o}=(0,v.useSelectedProjectQuery)(),{data:l,isPending:d}=(0,w.useTableEditorQuery)({projectRef:o?.ref,connectionString:o?.connectionString,id:a});return(0,s.useEffect)(()=>{if(l&&n){let e=(0,tw.createTabId)(l.entity_type,{id:l.id});r.tabsMap[e]?r.makeTabActive(e):r.addTab({id:e,type:l.entity_type,label:l.name,metadata:{schema:l.schema,name:l.name,tableId:a}})}},[l,a,n]),(0,t.jsx)(t_,{isLoadingSelectedTable:d,selectedTable:l})};tA.getLayout=e=>(0,t.jsx)(tP.DefaultLayout,{children:(0,t.jsx)(tL.EditorBaseLayout,{productMenu:(0,t.jsx)(tD.TableEditorMenu,{}),product:"Table Editor",productMenuClassName:"overflow-y-hidden",children:(0,t.jsx)(tI.TableEditorLayout,{children:e})})}),e.s(["default",0,tA],561912)},935074,(e,t,s)=>{let i="/project/[ref]/editor/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([i,()=>e.r(561912)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([i])})}]);

//# debugId=860f1a41-69ab-5f29-4cce-8e5b85970190
//# sourceMappingURL=751b7064c53412c4.js.map